<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.ico"><title>å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰ | ç©ºå±±æœ¨å··</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-90eac310.css" as="style"><link rel="stylesheet" href="/blog/assets/style-90eac310.css">
    <link rel="modulepreload" href="/blog/assets/app-66d6b4fd.js"><link rel="modulepreload" href="/blog/assets/å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰.html-43a94299.js"><link rel="modulepreload" href="/blog/assets/å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰.html-0534ba04.js"><link rel="prefetch" href="/blog/assets/index.html-33f7dfbb.js" as="script"><link rel="prefetch" href="/blog/assets/åˆ†å¸ƒå¼äº‹åŠ¡.html-99ca016c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-67c923f9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c0e7ceff.js" as="script"><link rel="prefetch" href="/blog/assets/Redisç¼“å­˜.html-988c20bf.js" as="script"><link rel="prefetch" href="/blog/assets/SaaSå¤šç§Ÿæˆ·.html-0b4298a2.js" as="script"><link rel="prefetch" href="/blog/assets/åŠŸèƒ½æƒé™.html-1a5bbea9.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®åº“ MyBatis.html-0283d0f0.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®æƒé™.html-06e84b51.js" as="script"><link rel="prefetch" href="/blog/assets/æœ¬åœ°ç¼“å­˜.html-b0021a15.js" as="script"><link rel="prefetch" href="/blog/assets/æ¶ˆæ¯é˜Ÿåˆ—.html-b31ff32c.js" as="script"><link rel="prefetch" href="/blog/assets/ç”¨æˆ·è®¤è¯.html-9edb96f7.js" as="script"><link rel="prefetch" href="/blog/assets/ç³»ç»Ÿæ—¥å¿—.html-6f65c9c7.js" as="script"><link rel="prefetch" href="/blog/assets/ç»Ÿä¸€å“åº”å’Œå¼‚å¸¸å¤„ç†ï¼ˆé”™è¯¯ç ï¼‰.html-48753ae0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4751f011.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3cba283.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQLå¸¸ç”¨çš„å‘½ä»¤.html-ee92d52b.js" as="script"><link rel="prefetch" href="/blog/assets/13-è´£ä»»é“¾æ¨¡å¼.html-ecb3744d.js" as="script"><link rel="prefetch" href="/blog/assets/14-å‘½ä»¤æ¨¡å¼.html-5eb58d88.js" as="script"><link rel="prefetch" href="/blog/assets/15-è§£æå™¨æ¨¡å¼.html-96606363.js" as="script"><link rel="prefetch" href="/blog/assets/16-è¿­ä»£å™¨æ¨¡å¼.html-8ebf1e59.js" as="script"><link rel="prefetch" href="/blog/assets/17-ä¸­ä»‹è€…æ¨¡å¼.html-a0f26b82.js" as="script"><link rel="prefetch" href="/blog/assets/18-å¤‡å¿˜å½•æ¨¡å¼.html-37ec7801.js" as="script"><link rel="prefetch" href="/blog/assets/19-è§‚å¯Ÿè€…æ¨¡å¼.html-68ace6a1.js" as="script"><link rel="prefetch" href="/blog/assets/20-çŠ¶æ€æ¨¡å¼.html-a5f78c82.js" as="script"><link rel="prefetch" href="/blog/assets/21-ç­–ç•¥æ¨¡å¼.html-a0ea40f7.js" as="script"><link rel="prefetch" href="/blog/assets/22-æ¨¡æ¿æ–¹æ³•æ¨¡å¼.html-f1f66b72.js" as="script"><link rel="prefetch" href="/blog/assets/23-è®¿é—®è€…æ¨¡å¼.html-cd09056c.js" as="script"><link rel="prefetch" href="/blog/assets/1-å•ä¾‹æ¨¡å¼.html-5e97ccb1.js" as="script"><link rel="prefetch" href="/blog/assets/2-æŠ½è±¡å·¥å‚æ¨¡å¼.html-2a70948c.js" as="script"><link rel="prefetch" href="/blog/assets/3-å·¥å‚æ–¹æ³•æ¨¡å¼.html-88c631dd.js" as="script"><link rel="prefetch" href="/blog/assets/4-å»ºé€ è€…æ¨¡å¼.html-210f3d70.js" as="script"><link rel="prefetch" href="/blog/assets/5-åŸå‹æ¨¡å¼.html-e37c22fb.js" as="script"><link rel="prefetch" href="/blog/assets/10-æ¡¥æ¥æ¨¡å¼.html-bb899021.js" as="script"><link rel="prefetch" href="/blog/assets/11-ç»„åˆæ¨¡å¼.html-608f7edb.js" as="script"><link rel="prefetch" href="/blog/assets/12-äº«å…ƒæ¨¡å¼.html-7eb14c96.js" as="script"><link rel="prefetch" href="/blog/assets/6-é€‚é…å™¨æ¨¡å¼.html-42ada3ad.js" as="script"><link rel="prefetch" href="/blog/assets/7-è£…é¥°å™¨æ¨¡å¼.html-8765fae1.js" as="script"><link rel="prefetch" href="/blog/assets/8-å¤–è§‚æ¨¡å¼.html-0103ad00.js" as="script"><link rel="prefetch" href="/blog/assets/9-ä»£ç†æ¨¡å¼.html-72f08df8.js" as="script"><link rel="prefetch" href="/blog/assets/UMLç±»å›¾.html-56387884.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8æ–°ç‰¹æ€§æ¦‚è¿°.html-adb6e16e.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream APIçš„ä¸­é—´æ“ä½œ.html-dcbf3f12.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream APIçš„ç»ˆæ­¢æ“ä½œ.html-cc9d125f.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optionalç±».html-c4d2ef31.js" as="script"><link rel="prefetch" href="/blog/assets/13-æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•.html-f470ea46.js" as="script"><link rel="prefetch" href="/blog/assets/14-æ–°æ—¥æœŸæ—¶é—´API.html-dcbed7d9.js" as="script"><link rel="prefetch" href="/blog/assets/15-é‡å¤æ³¨è§£ä¸ç±»å‹æ³¨è§£.html-f2f3eca7.js" as="script"><link rel="prefetch" href="/blog/assets/2-å¼•å…¥Lambdaè¡¨è¾¾å¼.html-e6241b21.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambdaè¡¨è¾¾å¼åŸºç¡€è¯­æ³•.html-26b78f6c.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambdaè¡¨è¾¾å¼å…¸å‹æ¡ˆä¾‹.html-0dca302e.js" as="script"><link rel="prefetch" href="/blog/assets/5-å‡½æ•°å¼æ¥å£.html-95fa5e28.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7å’ŒJava8çš„HashMap.html-1eb0c9da.js" as="script"><link rel="prefetch" href="/blog/assets/7-æ–¹æ³•å¼•ç”¨å’Œæ„é€ å™¨å¼•ç”¨.html-f6d10b42.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream APIåŸºç¡€.html-90d2d127.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream APIçš„åˆ›å»ºæ¡ˆä¾‹.html-1f13fad9.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQå…¥é—¨.html-c20c90f0.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQéƒ¨ç½²æŒ‡å—.html-6d5dea63.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQé«˜çº§.html-713abb8b.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQç®€ä»‹.html-df81724a.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQéƒ¨ç½²æŒ‡å—.html-34d27c15.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQé—®é¢˜ä¸è§£å†³.html-c596414a.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQå…¥é—¨.html-d4ef1d3d.js" as="script"><link rel="prefetch" href="/blog/assets/Dockerå®‰è£….html-299af5cc.js" as="script"><link rel="prefetch" href="/blog/assets/Dockerå®ç”¨ç¯‡.html-52d0916d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e263db13.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9dd24a6d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0d946030.js" as="script"><link rel="prefetch" href="/blog/assets/Linuxè™šæ‹Ÿæœºå…‹éš†.html-b438ca2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dd625d67.js" as="script"><link rel="prefetch" href="/blog/assets/VMwareå®‰è£…CentOS7.html-a73884c0.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e2ad7188.js" as="script"><link rel="prefetch" href="/blog/assets/åˆ†å¸ƒå¼äº‹åŠ¡.html-794c1916.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-98e4866e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2fb772ff.js" as="script"><link rel="prefetch" href="/blog/assets/Redisç¼“å­˜.html-bd0daed9.js" as="script"><link rel="prefetch" href="/blog/assets/SaaSå¤šç§Ÿæˆ·.html-a2055fe0.js" as="script"><link rel="prefetch" href="/blog/assets/åŠŸèƒ½æƒé™.html-2d8aaacc.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®åº“ MyBatis.html-e382d2a7.js" as="script"><link rel="prefetch" href="/blog/assets/æ•°æ®æƒé™.html-a5caa49b.js" as="script"><link rel="prefetch" href="/blog/assets/æœ¬åœ°ç¼“å­˜.html-f2290b7c.js" as="script"><link rel="prefetch" href="/blog/assets/æ¶ˆæ¯é˜Ÿåˆ—.html-a6146d9a.js" as="script"><link rel="prefetch" href="/blog/assets/ç”¨æˆ·è®¤è¯.html-9d064fff.js" as="script"><link rel="prefetch" href="/blog/assets/ç³»ç»Ÿæ—¥å¿—.html-ee40ac2f.js" as="script"><link rel="prefetch" href="/blog/assets/ç»Ÿä¸€å“åº”å’Œå¼‚å¸¸å¤„ç†ï¼ˆé”™è¯¯ç ï¼‰.html-6de026fa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-31a96e3c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a6895b4b.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQLå¸¸ç”¨çš„å‘½ä»¤.html-ca808bbc.js" as="script"><link rel="prefetch" href="/blog/assets/13-è´£ä»»é“¾æ¨¡å¼.html-37bc270e.js" as="script"><link rel="prefetch" href="/blog/assets/14-å‘½ä»¤æ¨¡å¼.html-565f0606.js" as="script"><link rel="prefetch" href="/blog/assets/15-è§£æå™¨æ¨¡å¼.html-a1e4bfaa.js" as="script"><link rel="prefetch" href="/blog/assets/16-è¿­ä»£å™¨æ¨¡å¼.html-ead46aeb.js" as="script"><link rel="prefetch" href="/blog/assets/17-ä¸­ä»‹è€…æ¨¡å¼.html-701b63f8.js" as="script"><link rel="prefetch" href="/blog/assets/18-å¤‡å¿˜å½•æ¨¡å¼.html-8cf3d53a.js" as="script"><link rel="prefetch" href="/blog/assets/19-è§‚å¯Ÿè€…æ¨¡å¼.html-dfb01611.js" as="script"><link rel="prefetch" href="/blog/assets/20-çŠ¶æ€æ¨¡å¼.html-e26f4307.js" as="script"><link rel="prefetch" href="/blog/assets/21-ç­–ç•¥æ¨¡å¼.html-27dc7c89.js" as="script"><link rel="prefetch" href="/blog/assets/22-æ¨¡æ¿æ–¹æ³•æ¨¡å¼.html-6eb9e5b2.js" as="script"><link rel="prefetch" href="/blog/assets/23-è®¿é—®è€…æ¨¡å¼.html-cf79916d.js" as="script"><link rel="prefetch" href="/blog/assets/1-å•ä¾‹æ¨¡å¼.html-89e83bdd.js" as="script"><link rel="prefetch" href="/blog/assets/2-æŠ½è±¡å·¥å‚æ¨¡å¼.html-f9ba82fa.js" as="script"><link rel="prefetch" href="/blog/assets/3-å·¥å‚æ–¹æ³•æ¨¡å¼.html-716e2ec4.js" as="script"><link rel="prefetch" href="/blog/assets/4-å»ºé€ è€…æ¨¡å¼.html-f9c85e95.js" as="script"><link rel="prefetch" href="/blog/assets/5-åŸå‹æ¨¡å¼.html-c346c412.js" as="script"><link rel="prefetch" href="/blog/assets/10-æ¡¥æ¥æ¨¡å¼.html-58973dc7.js" as="script"><link rel="prefetch" href="/blog/assets/11-ç»„åˆæ¨¡å¼.html-8845d578.js" as="script"><link rel="prefetch" href="/blog/assets/12-äº«å…ƒæ¨¡å¼.html-4f0564d0.js" as="script"><link rel="prefetch" href="/blog/assets/6-é€‚é…å™¨æ¨¡å¼.html-ee4a3eab.js" as="script"><link rel="prefetch" href="/blog/assets/7-è£…é¥°å™¨æ¨¡å¼.html-9da2ce9b.js" as="script"><link rel="prefetch" href="/blog/assets/8-å¤–è§‚æ¨¡å¼.html-de9ba17f.js" as="script"><link rel="prefetch" href="/blog/assets/9-ä»£ç†æ¨¡å¼.html-24224643.js" as="script"><link rel="prefetch" href="/blog/assets/UMLç±»å›¾.html-ee48f6ee.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8æ–°ç‰¹æ€§æ¦‚è¿°.html-ba7370a2.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream APIçš„ä¸­é—´æ“ä½œ.html-ab41c503.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream APIçš„ç»ˆæ­¢æ“ä½œ.html-579e0275.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optionalç±».html-2938f6c0.js" as="script"><link rel="prefetch" href="/blog/assets/13-æ¥å£ä¸­çš„é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•.html-4376d340.js" as="script"><link rel="prefetch" href="/blog/assets/14-æ–°æ—¥æœŸæ—¶é—´API.html-8cef1169.js" as="script"><link rel="prefetch" href="/blog/assets/15-é‡å¤æ³¨è§£ä¸ç±»å‹æ³¨è§£.html-14c69dac.js" as="script"><link rel="prefetch" href="/blog/assets/2-å¼•å…¥Lambdaè¡¨è¾¾å¼.html-cbb68b73.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambdaè¡¨è¾¾å¼åŸºç¡€è¯­æ³•.html-b874571a.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambdaè¡¨è¾¾å¼å…¸å‹æ¡ˆä¾‹.html-02ff3862.js" as="script"><link rel="prefetch" href="/blog/assets/5-å‡½æ•°å¼æ¥å£.html-a567c93c.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7å’ŒJava8çš„HashMap.html-d45c19ee.js" as="script"><link rel="prefetch" href="/blog/assets/7-æ–¹æ³•å¼•ç”¨å’Œæ„é€ å™¨å¼•ç”¨.html-5528bf63.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream APIåŸºç¡€.html-716d9e0b.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream APIçš„åˆ›å»ºæ¡ˆä¾‹.html-f8bfe8bc.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQå…¥é—¨.html-aa90e61e.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQéƒ¨ç½²æŒ‡å—.html-ae39e5df.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQé«˜çº§.html-ff1c439e.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQç®€ä»‹.html-734c9b0f.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQéƒ¨ç½²æŒ‡å—.html-73952eb6.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQé—®é¢˜ä¸è§£å†³.html-2b150a6b.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQå…¥é—¨.html-25974b8e.js" as="script"><link rel="prefetch" href="/blog/assets/Dockerå®‰è£….html-a0389f48.js" as="script"><link rel="prefetch" href="/blog/assets/Dockerå®ç”¨ç¯‡.html-ad5b2634.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3cba7701.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-646aeed4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d3ddc6e3.js" as="script"><link rel="prefetch" href="/blog/assets/Linuxè™šæ‹Ÿæœºå…‹éš†.html-32214cd3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cdeca630.js" as="script"><link rel="prefetch" href="/blog/assets/VMwareå®‰è£…CentOS7.html-4cd1bd26.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-d672d3fd.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/images/logo.png" alt="ç©ºå±±æœ¨å··"><span class="site-name can-hide">ç©ºå±±æœ¨å··</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å®¹å™¨æœåŠ¡</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å¼€å‘å·¥å…·</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8æ–°ç‰¹æ€§æ¦‚è¿°.md" class="" aria-label="java8æ–°ç‰¹æ€§"><!--[--><!--]--> java8æ–°ç‰¹æ€§ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title">åˆ†å¸ƒå¼</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title">åˆ†å¸ƒå¼</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/åˆ†å¸ƒå¼äº‹åŠ¡.md" class="" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><!--[--><!--]--> åˆ†å¸ƒå¼äº‹åŠ¡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title">æ•°æ®åº“</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æ•°æ®åº“"><span class="title">æ•°æ®åº“</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQLå¸¸ç”¨çš„å‘½ä»¤.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-å•ä¾‹æ¨¡å¼.md" class="" aria-label="è®¾è®¡æ¨¡å¼"><!--[--><!--]--> è®¾è®¡æ¨¡å¼ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!--[--><!--]--> æ¶ˆæ¯é˜Ÿåˆ— <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="router-link-active" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="é¦–é¡µ"><!--[--><!--]--> é¦–é¡µ <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="å·¥å…·"><span class="title">å·¥å…·</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å®¹å™¨æœåŠ¡</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>å¼€å‘å·¥å…·</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8æ–°ç‰¹æ€§æ¦‚è¿°.md" class="" aria-label="java8æ–°ç‰¹æ€§"><!--[--><!--]--> java8æ–°ç‰¹æ€§ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title">åˆ†å¸ƒå¼</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="åˆ†å¸ƒå¼"><span class="title">åˆ†å¸ƒå¼</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/åˆ†å¸ƒå¼äº‹åŠ¡.md" class="" aria-label="åˆ†å¸ƒå¼äº‹åŠ¡"><!--[--><!--]--> åˆ†å¸ƒå¼äº‹åŠ¡ <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="æ•°æ®åº“"><span class="title">æ•°æ®åº“</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="æ•°æ®åº“"><span class="title">æ•°æ®åº“</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQLå¸¸ç”¨çš„å‘½ä»¤.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-å•ä¾‹æ¨¡å¼.md" class="" aria-label="è®¾è®¡æ¨¡å¼"><!--[--><!--]--> è®¾è®¡æ¨¡å¼ <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!--[--><!--]--> æ¶ˆæ¯é˜Ÿåˆ— <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="router-link-active" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">kaysonç®¡ç†ç³»ç»Ÿ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/kayson/ç»Ÿä¸€å“åº”å’Œå¼‚å¸¸å¤„ç†ï¼ˆé”™è¯¯ç ï¼‰.md" class="sidebar-item" aria-label="ç»Ÿä¸€å“åº”å’Œå¼‚å¸¸å¤„ç†ï¼ˆé”™è¯¯ç ï¼‰"><!--[--><!--]--> ç»Ÿä¸€å“åº”å’Œå¼‚å¸¸å¤„ç†ï¼ˆé”™è¯¯ç ï¼‰ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/æ•°æ®åº“ Mybatis.md" class="sidebar-item" aria-label="æ•°æ®åº“ Mybatis"><!--[--><!--]--> æ•°æ®åº“ Mybatis <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/ç³»ç»Ÿæ—¥å¿—.md" class="sidebar-item" aria-label="ç³»ç»Ÿæ—¥å¿—"><!--[--><!--]--> ç³»ç»Ÿæ—¥å¿— <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/ç”¨æˆ·è®¤è¯.md" class="sidebar-item" aria-label="ç”¨æˆ·è®¤è¯"><!--[--><!--]--> ç”¨æˆ·è®¤è¯ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/åŠŸèƒ½æƒé™.md" class="sidebar-item" aria-label="åŠŸèƒ½æƒé™"><!--[--><!--]--> åŠŸèƒ½æƒé™ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/æ•°æ®æƒé™.md" class="sidebar-item" aria-label="æ•°æ®æƒé™"><!--[--><!--]--> æ•°æ®æƒé™ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/SaaSå¤šç§Ÿæˆ·.md" class="sidebar-item" aria-label="SaaSå¤šç§Ÿæˆ·"><!--[--><!--]--> SaaSå¤šç§Ÿæˆ· <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/Redisç¼“å­˜.md" class="sidebar-item" aria-label="Redisç¼“å­˜"><!--[--><!--]--> Redisç¼“å­˜ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/æœ¬åœ°ç¼“å­˜.md" class="sidebar-item" aria-label="æœ¬åœ°ç¼“å­˜"><!--[--><!--]--> æœ¬åœ°ç¼“å­˜ <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/æ¶ˆæ¯é˜Ÿåˆ—.md" class="sidebar-item" aria-label="æ¶ˆæ¯é˜Ÿåˆ—"><!--[--><!--]--> æ¶ˆæ¯é˜Ÿåˆ— <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰.md" class="sidebar-item active" aria-label="å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰"><!--[--><!--]--> å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="å¹‚ç­‰æ€§-é˜²é‡å¤æäº¤" tabindex="-1"><a class="header-anchor" href="#å¹‚ç­‰æ€§-é˜²é‡å¤æäº¤" aria-hidden="true">#</a> å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰</h1><p><a href="https://gitee.com/jhzhou/kayson/tree/master/kayson-framework/kayson-spring-boot-starter-protection" target="_blank" rel="noopener noreferrer">kayson-spring-boot-starter-protection<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æŠ€æœ¯ç»„ä»¶ï¼Œç”±å®ƒçš„ <a href="https://gitee.com/jhzhou/kayson/tree/master/kayson-framework/kayson-spring-boot-starter-protection/src/main/java/cn/zjh/kayson/framework/idempotent" target="_blank" rel="noopener noreferrer">idempotent<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> åŒ…ï¼Œæä¾›å£°æ˜å¼çš„å¹‚ç­‰ç‰¹æ€§ï¼Œå¯é˜²æ­¢é‡å¤è¯·æ±‚ã€‚ä¾‹å¦‚è¯´ï¼Œç”¨æˆ·å¿«é€Ÿçš„åŒå‡»äº†æŸä¸ªæŒ‰é’®ï¼Œå‰ç«¯æ²¡æœ‰ç¦ç”¨è¯¥æŒ‰é’®ï¼Œå¯¼è‡´å‘é€äº†ä¸¤æ¬¡é‡å¤çš„è¯·æ±‚ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// UserController.java</span>

<span class="token annotation punctuation">@Idempotent</span><span class="token punctuation">(</span>timeout <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> timeUnit <span class="token operator">=</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">&quot;æ­£åœ¨æ·»åŠ ç”¨æˆ·ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/create&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>
    userService<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;æ·»åŠ æˆåŠŸ&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-å®ç°åŸç†" aria-hidden="true">#</a> 1. å®ç°åŸç†</h2><p>å¹‚ç­‰ç»„ä»¶ï¼Œå‚è€ƒ https://github.com/it4alla/idempotent é¡¹ç›®å®ç°ã€‚</p><p>å®ƒçš„å®ç°åŸç†éå¸¸ç®€å•ï¼Œé’ˆå¯¹ç›¸åŒå‚æ•°çš„æ–¹æ³•ï¼Œä¸€æ®µæ—¶é—´å†…ï¼Œæœ‰ä¸”ä»…èƒ½æ‰§è¡Œä¸€æ¬¡ã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>â‘  åœ¨æ–¹æ³•æ‰§è¡Œå‰ï¼Œæ ¹æ®å‚æ•°å¯¹åº”çš„ Key æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ã€‚</p><ul><li>å¦‚æœ<strong>å­˜åœ¨</strong>ï¼Œè¯´æ˜æ­£åœ¨æ‰§è¡Œä¸­ï¼Œåˆ™è¿›è¡ŒæŠ¥é”™ã€‚</li><li>å¦‚æœ<strong>ä¸åœ¨</strong>ï¼Œåˆ™è®¡ç®—å‚æ•°å¯¹åº”çš„ Keyï¼Œå­˜å‚¨åˆ° Redis ä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå³æ ‡è®°æ­£åœ¨æ‰§è¡Œä¸­ã€‚</li></ul><p>é»˜è®¤å‚æ•°çš„ Redis Key çš„è®¡ç®—è§„åˆ™ç”± <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-protection/src/main/java/cn/zjh/kayson/framework/idempotent/core/keyresolver/impl/DefaultIdempotentKeyResolver.java" target="_blank" rel="noopener noreferrer">DefaultIdempotentKeyResolver<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å®ç°ï¼Œä½¿ç”¨ MD5(æ–¹æ³•å + æ–¹æ³•å‚æ•°)ï¼Œé¿å… Redis Key è¿‡é•¿ã€‚</p><p>â‘¡ æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œ<strong>ä¸ä¼š</strong>ä¸»åŠ¨åˆ é™¤å‚æ•°å¯¹åº”çš„ Keyã€‚</p><p>ğŸ™‚ ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œ<code>idempotent</code> åŒ…æä¾›çš„å¹‚ç­‰ç‰¹æ€§ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼é”ã€‚</p><p>â‘¢ å¦‚æœæ–¹æ³•æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œè¶…è¿‡ Key çš„è¿‡æœŸæ—¶é—´ï¼Œåˆ™ Redis ä¼šè‡ªåŠ¨åˆ é™¤å¯¹åº”çš„ Keyã€‚å› æ­¤ï¼Œéœ€è¦å¤§æ¦‚è¯„ä¼°ä¸‹ï¼Œé¿å…æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿‡æœŸæ—¶é—´ã€‚</p><h2 id="_2-idempotentkeyresolveræ¥å£" tabindex="-1"><a class="header-anchor" href="#_2-idempotentkeyresolveræ¥å£" aria-hidden="true">#</a> 2.IdempotentKeyResolveræ¥å£</h2><p>å¹‚ç­‰ Key è§£æå™¨æ¥å£ IdempotentKeyResolverï¼Œå®šä¹‰è§£æ Key çš„æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¹‚ç­‰ Key è§£æå™¨æ¥å£
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IdempotentKeyResolver</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * è§£æä¸€ä¸ª Key
     *
     * <span class="token keyword">@param</span> <span class="token parameter">joinPoint</span>  AOP åˆ‡é¢
     * <span class="token keyword">@param</span> <span class="token parameter">idempotent</span> å¹‚ç­‰æ³¨è§£
     * <span class="token keyword">@return</span> Key
     */</span>
    <span class="token class-name">String</span> <span class="token function">resolver</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Idempotent</span> idempotent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>é»˜è®¤çš„ Key è§£æå™¨å®ç°ï¼šDefaultIdempotentKeyResolverï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * é»˜è®¤å¹‚ç­‰ Key è§£æå™¨ï¼Œä½¿ç”¨æ–¹æ³•å + æ–¹æ³•å‚æ•°ï¼Œç»„è£…æˆä¸€ä¸ª Key
 * 
 * ä¸ºäº†é¿å… Key è¿‡é•¿ï¼Œä½¿ç”¨ MD5 è¿›è¡Œâ€œå‹ç¼©â€
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultIdempotentKeyResolver</span> <span class="token keyword">implements</span> <span class="token class-name">IdempotentKeyResolver</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resolver</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Idempotent</span> idempotent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> methodName <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> argsStr <span class="token operator">=</span> <span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">SecureUtil</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span>methodName <span class="token operator">+</span> argsStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>åŸºäº Spring EL è¡¨è¾¾å¼çš„ Key è§£æå™¨å®ç°ï¼šExpressionIdempotentKeyResolverï¼Œé€šè¿‡è§£ææ³¨è§£ @Idempotent çš„ keyArg() ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * åŸºäº Spring EL è¡¨è¾¾å¼
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExpressionIdempotentKeyResolver</span> <span class="token keyword">implements</span> <span class="token class-name">IdempotentKeyResolver</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ParameterNameDiscoverer</span> parameterNameDiscoverer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LocalVariableTableParameterNameDiscoverer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ExpressionParser</span> expressionParser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">resolver</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Idempotent</span> idempotent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å¾—è¢«æ‹¦æˆªæ–¹æ³•å‚æ•°ååˆ—è¡¨</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token function">getMethod</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterNames <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parameterNameDiscoverer<span class="token punctuation">.</span><span class="token function">getParameterNames</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å‡†å¤‡ Spring EL è¡¨è¾¾å¼è§£æçš„ä¸Šä¸‹æ–‡</span>
        <span class="token class-name">StandardEvaluationContext</span> evaluationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ArrayUtil</span><span class="token punctuation">.</span><span class="token function">isNotEmpty</span><span class="token punctuation">(</span>parameterNames<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parameterNames<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                evaluationContext<span class="token punctuation">.</span><span class="token function">setVariable</span><span class="token punctuation">(</span>parameterNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è§£æå‚æ•°</span>
        <span class="token class-name">Expression</span> expression <span class="token operator">=</span> expressionParser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>idempotent<span class="token punctuation">.</span><span class="token function">keyArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> expression<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>evaluationContext<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> point<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å¤„ç†ï¼Œå£°æ˜åœ¨ç±»ä¸Šçš„æƒ…å†µ</span>
        <span class="token class-name">MethodSignature</span> signature <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> point<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> signature<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> method<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// å¤„ç†ï¼Œå£°æ˜åœ¨æ¥å£ä¸Šçš„æƒ…å†µ</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> point<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span>
                    point<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-idempotentæ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_3-idempotentæ³¨è§£" aria-hidden="true">#</a> 3. @Idempotentæ³¨è§£</h2><p>@Idempotent æ³¨è§£ï¼Œå£°æ˜åœ¨æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•éœ€è¦å¼€å¯å¹‚ç­‰æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¹‚ç­‰æ³¨è§£
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Idempotent</span> <span class="token punctuation">{</span>
    
    <span class="token doc-comment comment">/**
     * å¹‚ç­‰çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º 1 ç§’
     *
     * æ³¨æ„ï¼Œå¦‚æœæ‰§è¡Œæ—¶é—´è¶…è¿‡å®ƒï¼Œè¯·æ±‚è¿˜æ˜¯ä¼šè¿›æ¥
     */</span>
    <span class="token keyword">int</span> <span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
    <span class="token doc-comment comment">/**
     * æ—¶é—´å•ä½ï¼Œé»˜è®¤ä¸º SECONDS ç§’
     */</span>
    <span class="token class-name">TimeUnit</span> <span class="token function">timeUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * æç¤ºä¿¡æ¯ï¼Œæ­£åœ¨æ‰§è¡Œä¸­çš„æç¤º
     */</span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;é‡å¤è¯·æ±‚ï¼Œè¯·ç¨åé‡è¯•&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * ä½¿ç”¨çš„ Key è§£æå™¨
     */</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">IdempotentKeyResolver</span><span class="token punctuation">&gt;</span></span> <span class="token function">keyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">DefaultIdempotentKeyResolver</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    
    <span class="token doc-comment comment">/**
     * ä½¿ç”¨çš„ Key å‚æ•°
     */</span>
    <span class="token class-name">String</span> <span class="token function">keyArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-aopåˆ‡é¢-idempotentaspect-ç±»" tabindex="-1"><a class="header-anchor" href="#_4-aopåˆ‡é¢-idempotentaspect-ç±»" aria-hidden="true">#</a> 4.AOPåˆ‡é¢ IdempotentAspect ç±»</h2><p>@Idempotent å¯¹åº”çš„ AOP åˆ‡é¢æ˜¯ IdempotentAspect ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * æ‹¦æˆªå£°æ˜äº† <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Idempotent</span></span><span class="token punctuation">}</span> æ³¨è§£çš„æ–¹æ³•ï¼Œå®ç°å¹‚ç­‰æ“ä½œ
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdempotentAspect</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Class</span><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">IdempotentKeyResolver</span><span class="token punctuation">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">IdempotentKeyResolver</span><span class="token punctuation">&gt;</span></span> keyResolvers<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">IdempotentRedisDAO</span> idempotentRedisDAO<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">IdempotentAspect</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">IdempotentKeyResolver</span><span class="token punctuation">&gt;</span></span> keyResolvers<span class="token punctuation">,</span> <span class="token class-name">IdempotentRedisDAO</span> idempotentRedisDAO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>keyResolvers <span class="token operator">=</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">convertMap</span><span class="token punctuation">(</span>keyResolvers<span class="token punctuation">,</span> <span class="token class-name">IdempotentKeyResolver</span><span class="token operator">::</span><span class="token function">getClass</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>idempotentRedisDAO <span class="token operator">=</span> idempotentRedisDAO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;@annotation(idempotent)&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforePointCut</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">,</span> <span class="token class-name">Idempotent</span> idempotent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å¾— IdempotentKeyResolver</span>
        <span class="token class-name">IdempotentKeyResolver</span> keyResolver <span class="token operator">=</span> keyResolvers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>idempotent<span class="token punctuation">.</span><span class="token function">keyResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è§£æ key</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> keyResolver<span class="token punctuation">.</span><span class="token function">resolver</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">,</span> idempotent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// é”å®š key</span>
        <span class="token class-name">Boolean</span> result <span class="token operator">=</span> idempotentRedisDAO<span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> idempotent<span class="token punctuation">.</span><span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> idempotent<span class="token punctuation">.</span><span class="token function">timeUnit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é”å®šå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token constant">FALSE</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;[beforePointCut][æ–¹æ³•({}) å‚æ•°({}) å­˜åœ¨é‡å¤è¯·æ±‚]&quot;</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServiceException</span><span class="token punctuation">(</span><span class="token class-name">GlobalErrorCodeConstants</span><span class="token punctuation">.</span><span class="token constant">REPEATED_REQUESTS</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> idempotent<span class="token punctuation">.</span><span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-idempotentredisdao" tabindex="-1"><a class="header-anchor" href="#_5-idempotentredisdao" aria-hidden="true">#</a> 5.IdempotentRedisDAO</h2><p>å¹‚ç­‰ Redis DAOï¼Œç”¨äºæ“ä½œRedisï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * å¹‚ç­‰ Redis DAO
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdempotentRedisDAO</span> <span class="token punctuation">{</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">StringRedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">RedisKeyDefine</span> <span class="token constant">IDEMPOTENT</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisKeyDefine</span><span class="token punctuation">(</span><span class="token string">&quot;å¹‚ç­‰æ“ä½œ&quot;</span><span class="token punctuation">,</span> 
            <span class="token string">&quot;idempotent:%s&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å‚æ•°ä¸º uuid</span>
            <span class="token class-name">RedisKeyDefine<span class="token punctuation">.</span>KeyTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> 
            <span class="token class-name">RedisKeyDefine<span class="token punctuation">.</span>TimeoutTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> timeout<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span> timeUnit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token constant">IDEMPOTENT</span><span class="token punctuation">.</span><span class="token function">getKeyTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> timeout<span class="token punctuation">,</span> timeUnit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-66d6b4fd.js" defer></script>
  </body>
</html>
