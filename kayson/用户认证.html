<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.ico"><title>用户认证 | 空山木巷</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-90eac310.css" as="style"><link rel="stylesheet" href="/blog/assets/style-90eac310.css">
    <link rel="modulepreload" href="/blog/assets/app-66d6b4fd.js"><link rel="modulepreload" href="/blog/assets/用户认证.html-9d064fff.js"><link rel="modulepreload" href="/blog/assets/用户认证.html-9edb96f7.js"><link rel="prefetch" href="/blog/assets/index.html-33f7dfbb.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-99ca016c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-67c923f9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c0e7ceff.js" as="script"><link rel="prefetch" href="/blog/assets/Redis缓存.html-988c20bf.js" as="script"><link rel="prefetch" href="/blog/assets/SaaS多租户.html-0b4298a2.js" as="script"><link rel="prefetch" href="/blog/assets/功能权限.html-1a5bbea9.js" as="script"><link rel="prefetch" href="/blog/assets/幂等性（防重复提交）.html-43a94299.js" as="script"><link rel="prefetch" href="/blog/assets/数据库 MyBatis.html-0283d0f0.js" as="script"><link rel="prefetch" href="/blog/assets/数据权限.html-06e84b51.js" as="script"><link rel="prefetch" href="/blog/assets/本地缓存.html-b0021a15.js" as="script"><link rel="prefetch" href="/blog/assets/消息队列.html-b31ff32c.js" as="script"><link rel="prefetch" href="/blog/assets/系统日志.html-6f65c9c7.js" as="script"><link rel="prefetch" href="/blog/assets/统一响应和异常处理（错误码）.html-48753ae0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4751f011.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3cba283.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQL常用的命令.html-ee92d52b.js" as="script"><link rel="prefetch" href="/blog/assets/13-责任链模式.html-ecb3744d.js" as="script"><link rel="prefetch" href="/blog/assets/14-命令模式.html-5eb58d88.js" as="script"><link rel="prefetch" href="/blog/assets/15-解析器模式.html-96606363.js" as="script"><link rel="prefetch" href="/blog/assets/16-迭代器模式.html-8ebf1e59.js" as="script"><link rel="prefetch" href="/blog/assets/17-中介者模式.html-a0f26b82.js" as="script"><link rel="prefetch" href="/blog/assets/18-备忘录模式.html-37ec7801.js" as="script"><link rel="prefetch" href="/blog/assets/19-观察者模式.html-68ace6a1.js" as="script"><link rel="prefetch" href="/blog/assets/20-状态模式.html-a5f78c82.js" as="script"><link rel="prefetch" href="/blog/assets/21-策略模式.html-a0ea40f7.js" as="script"><link rel="prefetch" href="/blog/assets/22-模板方法模式.html-f1f66b72.js" as="script"><link rel="prefetch" href="/blog/assets/23-访问者模式.html-cd09056c.js" as="script"><link rel="prefetch" href="/blog/assets/1-单例模式.html-5e97ccb1.js" as="script"><link rel="prefetch" href="/blog/assets/2-抽象工厂模式.html-2a70948c.js" as="script"><link rel="prefetch" href="/blog/assets/3-工厂方法模式.html-88c631dd.js" as="script"><link rel="prefetch" href="/blog/assets/4-建造者模式.html-210f3d70.js" as="script"><link rel="prefetch" href="/blog/assets/5-原型模式.html-e37c22fb.js" as="script"><link rel="prefetch" href="/blog/assets/10-桥接模式.html-bb899021.js" as="script"><link rel="prefetch" href="/blog/assets/11-组合模式.html-608f7edb.js" as="script"><link rel="prefetch" href="/blog/assets/12-享元模式.html-7eb14c96.js" as="script"><link rel="prefetch" href="/blog/assets/6-适配器模式.html-42ada3ad.js" as="script"><link rel="prefetch" href="/blog/assets/7-装饰器模式.html-8765fae1.js" as="script"><link rel="prefetch" href="/blog/assets/8-外观模式.html-0103ad00.js" as="script"><link rel="prefetch" href="/blog/assets/9-代理模式.html-72f08df8.js" as="script"><link rel="prefetch" href="/blog/assets/UML类图.html-56387884.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8新特性概述.html-adb6e16e.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream API的中间操作.html-dcbf3f12.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream API的终止操作.html-cc9d125f.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optional类.html-c4d2ef31.js" as="script"><link rel="prefetch" href="/blog/assets/13-接口中的默认方法和静态方法.html-f470ea46.js" as="script"><link rel="prefetch" href="/blog/assets/14-新日期时间API.html-dcbed7d9.js" as="script"><link rel="prefetch" href="/blog/assets/15-重复注解与类型注解.html-f2f3eca7.js" as="script"><link rel="prefetch" href="/blog/assets/2-引入Lambda表达式.html-e6241b21.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambda表达式基础语法.html-26b78f6c.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambda表达式典型案例.html-0dca302e.js" as="script"><link rel="prefetch" href="/blog/assets/5-函数式接口.html-95fa5e28.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7和Java8的HashMap.html-1eb0c9da.js" as="script"><link rel="prefetch" href="/blog/assets/7-方法引用和构造器引用.html-f6d10b42.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream API基础.html-90d2d127.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream API的创建案例.html-1f13fad9.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ入门.html-c20c90f0.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ部署指南.html-6d5dea63.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ高级.html-713abb8b.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ简介.html-df81724a.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ部署指南.html-34d27c15.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ问题与解决.html-c596414a.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQ入门.html-d4ef1d3d.js" as="script"><link rel="prefetch" href="/blog/assets/Docker安装.html-299af5cc.js" as="script"><link rel="prefetch" href="/blog/assets/Docker实用篇.html-52d0916d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e263db13.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9dd24a6d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0d946030.js" as="script"><link rel="prefetch" href="/blog/assets/Linux虚拟机克隆.html-b438ca2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dd625d67.js" as="script"><link rel="prefetch" href="/blog/assets/VMware安装CentOS7.html-a73884c0.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e2ad7188.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-794c1916.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-98e4866e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2fb772ff.js" as="script"><link rel="prefetch" href="/blog/assets/Redis缓存.html-bd0daed9.js" as="script"><link rel="prefetch" href="/blog/assets/SaaS多租户.html-a2055fe0.js" as="script"><link rel="prefetch" href="/blog/assets/功能权限.html-2d8aaacc.js" as="script"><link rel="prefetch" href="/blog/assets/幂等性（防重复提交）.html-0534ba04.js" as="script"><link rel="prefetch" href="/blog/assets/数据库 MyBatis.html-e382d2a7.js" as="script"><link rel="prefetch" href="/blog/assets/数据权限.html-a5caa49b.js" as="script"><link rel="prefetch" href="/blog/assets/本地缓存.html-f2290b7c.js" as="script"><link rel="prefetch" href="/blog/assets/消息队列.html-a6146d9a.js" as="script"><link rel="prefetch" href="/blog/assets/系统日志.html-ee40ac2f.js" as="script"><link rel="prefetch" href="/blog/assets/统一响应和异常处理（错误码）.html-6de026fa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-31a96e3c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a6895b4b.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQL常用的命令.html-ca808bbc.js" as="script"><link rel="prefetch" href="/blog/assets/13-责任链模式.html-37bc270e.js" as="script"><link rel="prefetch" href="/blog/assets/14-命令模式.html-565f0606.js" as="script"><link rel="prefetch" href="/blog/assets/15-解析器模式.html-a1e4bfaa.js" as="script"><link rel="prefetch" href="/blog/assets/16-迭代器模式.html-ead46aeb.js" as="script"><link rel="prefetch" href="/blog/assets/17-中介者模式.html-701b63f8.js" as="script"><link rel="prefetch" href="/blog/assets/18-备忘录模式.html-8cf3d53a.js" as="script"><link rel="prefetch" href="/blog/assets/19-观察者模式.html-dfb01611.js" as="script"><link rel="prefetch" href="/blog/assets/20-状态模式.html-e26f4307.js" as="script"><link rel="prefetch" href="/blog/assets/21-策略模式.html-27dc7c89.js" as="script"><link rel="prefetch" href="/blog/assets/22-模板方法模式.html-6eb9e5b2.js" as="script"><link rel="prefetch" href="/blog/assets/23-访问者模式.html-cf79916d.js" as="script"><link rel="prefetch" href="/blog/assets/1-单例模式.html-89e83bdd.js" as="script"><link rel="prefetch" href="/blog/assets/2-抽象工厂模式.html-f9ba82fa.js" as="script"><link rel="prefetch" href="/blog/assets/3-工厂方法模式.html-716e2ec4.js" as="script"><link rel="prefetch" href="/blog/assets/4-建造者模式.html-f9c85e95.js" as="script"><link rel="prefetch" href="/blog/assets/5-原型模式.html-c346c412.js" as="script"><link rel="prefetch" href="/blog/assets/10-桥接模式.html-58973dc7.js" as="script"><link rel="prefetch" href="/blog/assets/11-组合模式.html-8845d578.js" as="script"><link rel="prefetch" href="/blog/assets/12-享元模式.html-4f0564d0.js" as="script"><link rel="prefetch" href="/blog/assets/6-适配器模式.html-ee4a3eab.js" as="script"><link rel="prefetch" href="/blog/assets/7-装饰器模式.html-9da2ce9b.js" as="script"><link rel="prefetch" href="/blog/assets/8-外观模式.html-de9ba17f.js" as="script"><link rel="prefetch" href="/blog/assets/9-代理模式.html-24224643.js" as="script"><link rel="prefetch" href="/blog/assets/UML类图.html-ee48f6ee.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8新特性概述.html-ba7370a2.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream API的中间操作.html-ab41c503.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream API的终止操作.html-579e0275.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optional类.html-2938f6c0.js" as="script"><link rel="prefetch" href="/blog/assets/13-接口中的默认方法和静态方法.html-4376d340.js" as="script"><link rel="prefetch" href="/blog/assets/14-新日期时间API.html-8cef1169.js" as="script"><link rel="prefetch" href="/blog/assets/15-重复注解与类型注解.html-14c69dac.js" as="script"><link rel="prefetch" href="/blog/assets/2-引入Lambda表达式.html-cbb68b73.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambda表达式基础语法.html-b874571a.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambda表达式典型案例.html-02ff3862.js" as="script"><link rel="prefetch" href="/blog/assets/5-函数式接口.html-a567c93c.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7和Java8的HashMap.html-d45c19ee.js" as="script"><link rel="prefetch" href="/blog/assets/7-方法引用和构造器引用.html-5528bf63.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream API基础.html-716d9e0b.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream API的创建案例.html-f8bfe8bc.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ入门.html-aa90e61e.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ部署指南.html-ae39e5df.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ高级.html-ff1c439e.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ简介.html-734c9b0f.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ部署指南.html-73952eb6.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ问题与解决.html-2b150a6b.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQ入门.html-25974b8e.js" as="script"><link rel="prefetch" href="/blog/assets/Docker安装.html-a0389f48.js" as="script"><link rel="prefetch" href="/blog/assets/Docker实用篇.html-ad5b2634.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3cba7701.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-646aeed4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d3ddc6e3.js" as="script"><link rel="prefetch" href="/blog/assets/Linux虚拟机克隆.html-32214cd3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cdeca630.js" as="script"><link rel="prefetch" href="/blog/assets/VMware安装CentOS7.html-4cd1bd26.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-d672d3fd.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/images/logo.png" alt="空山木巷"><span class="site-name can-hide">空山木巷</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8新特性概述.md" class="" aria-label="java8新特性"><!--[--><!--]--> java8新特性 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/分布式事务.md" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQL常用的命令.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-单例模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="router-link-active" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8新特性概述.md" class="" aria-label="java8新特性"><!--[--><!--]--> java8新特性 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/分布式事务.md" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQL常用的命令.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-单例模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="router-link-active" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">kayson管理系统 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/kayson/统一响应和异常处理（错误码）.md" class="sidebar-item" aria-label="统一响应和异常处理（错误码）"><!--[--><!--]--> 统一响应和异常处理（错误码） <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/数据库 Mybatis.md" class="sidebar-item" aria-label="数据库 Mybatis"><!--[--><!--]--> 数据库 Mybatis <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/系统日志.md" class="sidebar-item" aria-label="系统日志"><!--[--><!--]--> 系统日志 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/用户认证.md" class="sidebar-item active" aria-label="用户认证"><!--[--><!--]--> 用户认证 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/功能权限.md" class="sidebar-item" aria-label="功能权限"><!--[--><!--]--> 功能权限 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/数据权限.md" class="sidebar-item" aria-label="数据权限"><!--[--><!--]--> 数据权限 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/SaaS多租户.md" class="sidebar-item" aria-label="SaaS多租户"><!--[--><!--]--> SaaS多租户 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/Redis缓存.md" class="sidebar-item" aria-label="Redis缓存"><!--[--><!--]--> Redis缓存 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/本地缓存.md" class="sidebar-item" aria-label="本地缓存"><!--[--><!--]--> 本地缓存 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/消息队列.md" class="sidebar-item" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a><!----></li><li><a href="/blog/kayson/幂等性（防重复提交）.md" class="sidebar-item" aria-label="幂等性（防重复提交）"><!--[--><!--]--> 幂等性（防重复提交） <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="用户认证" tabindex="-1"><a class="header-anchor" href="#用户认证" aria-hidden="true">#</a> 用户认证</h1><h2 id="_1-如何实现用户的创建" tabindex="-1"><a class="header-anchor" href="#_1-如何实现用户的创建" aria-hidden="true">#</a> 1.如何实现用户的创建？</h2><p>用户表 system_users</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>system_users<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户ID&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户账号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;密码&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>nickname<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户昵称&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>remark<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;备注&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>dept_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;部门ID&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>post_ids<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;岗位编号数组&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>email<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户邮箱&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>mobile<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;手机号码&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户性别&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>avatar<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;头像地址&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>status<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;帐号状态（0正常 1停用）&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>login_ip<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;最后登录IP&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>login_date<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;最后登录时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>creator<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>updater<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> b<span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;是否删除&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;租户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span><span class="token punctuation">,</span>
  <span class="token keyword">UNIQUE</span> <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>idx_username<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span><span class="token punctuation">,</span><span class="token identifier"><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">127</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;用户信息表&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>前端实现：views/system/user/index.vue</p><p>后端实现：</p><ul><li>实体 - AdminUserDO</li><li>逻辑 - UserController =&gt; AdminUserService =&gt; AdminUserMapper</li></ul><h2 id="_2-token令牌" tabindex="-1"><a class="header-anchor" href="#_2-token令牌" aria-hidden="true">#</a> 2.Token令牌</h2><h3 id="_2-1生成用户认证token令牌" tabindex="-1"><a class="header-anchor" href="#_2-1生成用户认证token令牌" aria-hidden="true">#</a> 2.1生成用户认证Token令牌</h3><p>表设计：</p><p>system_oauth2_access_token：访问令牌，短过期时间</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>system_oauth2_access_token<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_type<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户类型&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>access_token<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;访问令牌&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>refresh_token<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;刷新令牌&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;客户端编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>scopes<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;授权范围&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>expires_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;过期时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>creator<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>updater<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> b<span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;是否删除&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;租户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">15</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;OAuth2 访问令牌&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>system_oauth2_refresh_token：刷新令牌，长过期时间</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>system_oauth2_refresh_token<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>refresh_token<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;刷新令牌&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>user_type<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;用户类型&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>client_id<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;客户端编号&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>scopes<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;授权范围&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>expires_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;过期时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>creator<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;创建时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>updater<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci <span class="token keyword">DEFAULT</span> <span class="token string">&#39;&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新者&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;更新时间&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">bit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> b<span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;是否删除&#39;</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>tenant_id<span class="token punctuation">`</span></span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">&#39;0&#39;</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;租户编号&#39;</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">USING</span> <span class="token keyword">BTREE</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">11</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_unicode_ci <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;OAuth2 刷新令牌&#39;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成 Token 逻辑：生成刷新令牌；生成访问令牌，并写入到 redis。</p><p>移除 Token 逻辑：删除访问令牌，并删除 redis；删除刷新令牌。</p><p>具体实现见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/service/oauth2/OAuth2TokenServiceImpl.java" target="_blank" rel="noopener noreferrer">OAuth2TokenServiceImpl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中的 <code>#createAccessToken()</code> 和 <code>#removeAccessToken()</code>。</p><h3 id="_2-2校验用户认证-token-令牌" tabindex="-1"><a class="header-anchor" href="#_2-2校验用户认证-token-令牌" aria-hidden="true">#</a> 2.2校验用户认证 Token 令牌</h3><p>前端通过 header[AUTHORIZATION] 传递访问令牌。</p><p>后端通过 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-security/src/main/java/cn/zjh/kayson/framework/security/core/filter/TokenAuthenticationFilter.java" target="_blank" rel="noopener noreferrer">TokenAuthenticationFilter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 进行Token校验，并构建LoginUser 在线用户：</p><ol><li>解析 header[AUTHORIZATION] 获得访问令牌，若不存在，执行下一条过滤链</li><li>调用 oauth2TokenApi 解析访问令牌的 userId、userType 等信息（具体实现可见<a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/service/oauth2/OAuth2TokenServiceImpl.java" target="_blank" rel="noopener noreferrer">OAuth2TokenServiceImpl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中的<code>#checkAccessToken()</code>），构建出 LoginUser 在线用户</li><li>将 LoginUser 设置到 Spring Security 的 SecurityContext 上下文</li></ol><h3 id="_2-3刷新用户认证-token-令牌" tabindex="-1"><a class="header-anchor" href="#_2-3刷新用户认证-token-令牌" aria-hidden="true">#</a> 2.3刷新用户认证 Token 令牌</h3><p>后端通过 /system/auth/refresh_token 刷新令牌，生成新的访问令牌、并设置到 redis 中，一种“特殊”的登录，返回结果和登录一致。</p><p>后端实现可见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/service/oauth2/OAuth2TokenServiceImpl.java" target="_blank" rel="noopener noreferrer">OAuth2TokenServiceImpl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中的<code>#refreshAccessToken()</code></p><p>前端实现可见 src\config\axios\service.ts 文件</p><h3 id="_2-4token认证机制" tabindex="-1"><a class="header-anchor" href="#_2-4token认证机制" aria-hidden="true">#</a> 2.4Token认证机制</h3><p>安全框架使用的是 Spring Security + 双Token 方案。整体流程如下图所示：</p><p><img src="/blog/kayson/Snipaste_2023-06-13_18-14-44.png" alt="Snipaste_2023-06-13_18-14-44"></p><p>① 前端调用登录接口，使用账号密码获得到认证 Token。响应示例如下：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;code&quot;</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;data&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token property">&quot;token&quot;</span><span class="token operator">:</span><span class="token string">&quot;d2a3cdbc6c53470db67a582bd115103f&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>管理后台登录实现，见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/service/auth/AdminAuthServiceImpl.java" target="_blank" rel="noopener noreferrer">AdminAuthServiceImpl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中 <code>#login()</code> 方法。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>疑问：为什么不使用 Spring Security 内置的表单登录？</p><p>Spring Security 的登录拓展起来不方便，例如说验证码、三方登录等等。</p></div><p>Token 存储在数据库中，对应 <code>system_oauth2_access_token</code> 访问令牌表的 <code>id</code> 字段。考虑到访问的性能，缓存在 Redis 的 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/dal/redis/RedisKeyConstants.java" target="_blank" rel="noopener noreferrer">oauth2_access_token:%s<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 键中。</p><div class="custom-container tip"><p class="custom-container-title">提示</p><p>疑问：为什么不使用 JWT(JSON Web Token)？</p><p>JWT 是无状态的，无法实现 Token 的作废，例如说用户登出系统、修改密码等等场景。</p></div><p>默认配置下，Token 有效期为 30 天，可通过 <code>system_oauth2_client</code> 表中 <code>client_id = default</code> 的记录进行自定义：</p><ul><li>修改 <code>access_token_validity_seconds</code> 字段，设置访问令牌的过期时间，默认 1800 秒 = 30 分钟</li><li>修改 <code>refresh_token_validity_seconds</code> 字段，设置刷新令牌的过期时间，默认 43200 秒 = 30 天</li></ul><p>② 前端调用其它接口，需要在请求头带上 Token 进行访问。请求头格式如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">### Authorization: Bearer 登录时返回的 Token</span>
Authorization: Bearer d2a3cdbc6c53470db67a582bd115103f
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>具体的代码实现，可见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-security/src/main/java/cn/zjh/kayson/framework/security/core/filter/TokenAuthenticationFilter.java" target="_blank" rel="noopener noreferrer">TokenAuthenticationFilter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 过滤器</p><p>考虑到使用 Postman、Swagger 调试接口方便，提供了 <strong>Token 的模拟机制</strong>。请求头格式如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">### Authorization: Bearer test用户编号</span>
Authorization: Bearer test1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>test 可自定义，通过yaml文件经行配置。</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">### application-local.yaml</span>

<span class="token key atrule">kayson</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">mock-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># 是否开启 Token 的模拟机制</span>
    <span class="token key atrule">mock-secret</span><span class="token punctuation">:</span> test <span class="token comment"># Token 模拟机制的 Token 前缀</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置类 SecurityProperties 如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">&quot;kayson.security&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SecurityProperties</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * HTTP 请求时，访问令牌的请求 Header
     */</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;Token Header 不能为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> tokenHeader <span class="token operator">=</span> <span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * mock 模式的开关
     */</span>
    <span class="token annotation punctuation">@NotNull</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;mock 模式的开关不能为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> mockEnable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * mock 模式的密钥
     * 一定要配置密钥，保证安全性
     */</span>
    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;mock 模式的密钥不能为空&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 这里设置了一个默认值，因为实际上只有 mockEnable 为 true 时才需要配置。</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mockSecret <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * 免登录的 URL 列表
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> permitAllUrls <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * PasswordEncoder 加密复杂度，越高开销越大
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> passwordEncoderLength <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-登录与登出" tabindex="-1"><a class="header-anchor" href="#_3-登录与登出" aria-hidden="true">#</a> 3.登录与登出</h2><h3 id="_3-1账号密码登录" tabindex="-1"><a class="header-anchor" href="#_3-1账号密码登录" aria-hidden="true">#</a> 3.1账号密码登录</h3><p>使用 <code>username</code> 账号 + <code>password</code> 密码进行登录，由 AuthController 提供的接口 /system/auth/login。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PermitAll</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;使用账号密码登录&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@OperateLog</span><span class="token punctuation">(</span>enable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 避免 Post 请求被记录操作日志</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthLoginRespVO</span><span class="token punctuation">&gt;</span></span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token annotation punctuation">@Valid</span> <span class="token class-name">AuthLoginReqVO</span> reqVO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> token <span class="token operator">=</span> authService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>reqVO<span class="token punctuation">,</span> <span class="token function">getClientIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getUserAgent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回结果</span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">AuthLoginRespVO</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>登录流程：</p><ol><li>校验验证码</li><li>校验用户名密码</li><li>记录成功的登录日志、访问令牌</li></ol><p>具体逻辑见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/service/auth/AdminAuthServiceImpl.java" target="_blank" rel="noopener noreferrer">AdminAuthServiceImpl<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中 <code>#login()</code> 方法</p><h3 id="_3-2登出" tabindex="-1"><a class="header-anchor" href="#_3-2登出" aria-hidden="true">#</a> 3.2登出</h3><p>由 AuthController 提供的接口 /system/auth/logout 进行登出。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/logout&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@PermitAll</span>
<span class="token annotation punctuation">@Operation</span><span class="token punctuation">(</span>summary <span class="token operator">=</span> <span class="token string">&quot;登出系统&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@OperateLog</span><span class="token punctuation">(</span>enable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 避免 Post 请求被记录操作日志</span>
<span class="token keyword">public</span> <span class="token class-name">CommonResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> token <span class="token operator">=</span> <span class="token class-name">SecurityFrameworkUtils</span><span class="token punctuation">.</span><span class="token function">obtainAuthorization</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> securityProperties<span class="token punctuation">.</span><span class="token function">getTokenHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StrUtil</span><span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        authService<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token class-name">LoginLogTypeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGOUT_SELF</span><span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>登出流程；</p><ol><li>删除访问令牌</li><li>记录登出日志</li></ol><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">,</span> <span class="token class-name">Integer</span> logoutType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 删除访问令牌</span>
    <span class="token class-name">OAuth2AccessTokenDO</span> accessTokenDO <span class="token operator">=</span> oAuth2TokenService<span class="token punctuation">.</span><span class="token function">removeAccessToken</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>accessTokenDO <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 删除成功，则记录登出日志</span>
    <span class="token function">createLogoutLog</span><span class="token punctuation">(</span>accessTokenDO<span class="token punctuation">.</span><span class="token function">getUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> accessTokenDO<span class="token punctuation">.</span><span class="token function">getUserType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> logoutType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3如何实现-url-是否需要登录" tabindex="-1"><a class="header-anchor" href="#_3-3如何实现-url-是否需要登录" aria-hidden="true">#</a> 3.3如何实现 URL 是否需要登录？</h3><p>① 全局配置</p><ol><li>@PermitAll 注解</li><li>kayson.security.permit-all-urls 配置项</li><li>httpSecurity.antMatchers(buildAppApi()).permitAll()</li></ol><p>② 每个项目的自定义规则</p><p>​ <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-security/src/main/java/cn/zjh/kayson/framework/security/config/AuthorizeRequestsCustomizer.java" target="_blank" rel="noopener noreferrer">AuthorizeRequestsCustomizer<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 抽象类</p><p>③ 兜底规则，必须认证：httpSecurity.anyRequest().authenticated()</p><p>具体实现见 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-security/src/main/java/cn/zjh/kayson/framework/security/config/KaysonWebSecurityConfigurerAdapter.java" target="_blank" rel="noopener noreferrer">KaysonWebSecurityConfigurerAdapter<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 中的 <code>#filterChain()</code></p><h3 id="_3-4如何获取当前登录的用户" tabindex="-1"><a class="header-anchor" href="#_3-4如何获取当前登录的用户" aria-hidden="true">#</a> 3.4如何获取当前登录的用户？</h3><p>通过 <a href="https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-security/src/main/java/cn/zjh/kayson/framework/security/core/util/SecurityFrameworkUtils.java" target="_blank" rel="noopener noreferrer">SecurityFrameworkUtils<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 工具类提供的方法，可以获得当前登录用户的信息。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-66d6b4fd.js" defer></script>
  </body>
</html>
