import{_ as e,o as a,c as s,e as n}from"./app-66d6b4fd.js";const r={},l=n(`<h1 id="rocketmq问题与解决" tabindex="-1"><a class="header-anchor" href="#rocketmq问题与解决" aria-hidden="true">#</a> RocketMQ问题与解决</h1><h2 id="解决rocketmq发送消息报错-service-not-available-now-maybe-disk-full-cl-0-87-cq-0-87-index-0-87-maybe-your-broker-machine-memory-too-small" tabindex="-1"><a class="header-anchor" href="#解决rocketmq发送消息报错-service-not-available-now-maybe-disk-full-cl-0-87-cq-0-87-index-0-87-maybe-your-broker-machine-memory-too-small" aria-hidden="true">#</a> 解决rocketmq发送消息报错： service not available now, maybe disk full, CL: 0.87 CQ: 0.87 INDEX: 0.87, maybe your broker machine memory too small</h2><h3 id="问题出现" tabindex="-1"><a class="header-anchor" href="#问题出现" aria-hidden="true">#</a> 问题出现</h3><p>发送消息时，出现如下问题；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>com.alibaba.rocketmq.client.exception.MQBrokerException: CODE: <span class="token number">14</span> DESC: <span class="token function">service</span> not available now, maybe disk full, CL: <span class="token number">0.87</span> CQ: <span class="token number">0.87</span> INDEX: <span class="token number">0.87</span>, maybe your broker machine memory too small.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="问题分析与解决" tabindex="-1"><a class="header-anchor" href="#问题分析与解决" aria-hidden="true">#</a> 问题分析与解决</h3><p>看报错应该是磁盘空间不足的问题。</p><ul><li><strong>查看磁盘空间</strong></li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">df</span> <span class="token parameter variable">-h</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>发现已用90%，查阅百度之后发现rocketmq源码的DefaultMessageStore类里，默认会把剩余磁盘的比率不足75%(rocketmq版本不同这个比率好像不一样)当做磁盘空间不足处理，看来磁盘是有点不够了。</p><ul><li><strong>配置默认磁盘比率</strong></li></ul><p>在 broker.conf 配置文件中添加一行配置(diskMaxUsedSpaceRatio=99)，表示剩余磁盘比例不足99才报错。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>brokerClusterName <span class="token operator">=</span> DefaultCluster
brokerName <span class="token operator">=</span> broker-a
brokerId <span class="token operator">=</span> <span class="token number">0</span>
deleteWhen <span class="token operator">=</span> 04
fileReservedTime <span class="token operator">=</span> <span class="token number">48</span>
brokerRole <span class="token operator">=</span> ASYNC_MASTER
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token assign-left variable">brokerIP1</span><span class="token operator">=</span><span class="token number">192.168</span>.100.99
<span class="token comment"># 剩余磁盘比率，表示剩余磁盘比例不足99才报错</span>
<span class="token assign-left variable">diskMaxUsedSpaceRatio</span><span class="token operator">=</span><span class="token number">99</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>重启mq</li></ul>`,14),o=[l];function i(t,c){return a(),s("div",null,o)}const p=e(r,[["render",i],["__file","RocketMQ问题与解决.html.vue"]]);export{p as default};
