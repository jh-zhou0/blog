import{_ as p,r as o,o as c,c as i,a as n,d as s,b as e,e as t}from"./app-66d6b4fd.js";const l="/blog/kayson/Snipaste_2023-06-14_18-58-06.png",u="/blog/kayson/Snipaste_2023-06-14_19-14-37.png",r="/blog/kayson/Snipaste_2023-06-14_19-17-30.png",d="/blog/kayson/Snipaste_2023-06-14_19-21-44.png",k={},m=n("h1",{id:"redis-ç¼“å­˜",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#redis-ç¼“å­˜","aria-hidden":"true"},"#"),s(" Redis ç¼“å­˜")],-1),v={href:"https://gitee.com/jhzhou/kayson/tree/master/kayson-framework/kayson-spring-boot-starter-redis",target:"_blank",rel:"noopener noreferrer"},h=t(`<ul><li>ç¼–ç¨‹å¼ç¼“å­˜ï¼šåŸºäº Spring Data Redis æ¡†æ¶çš„ RedisTemplate æ“ä½œæ¨¡æ¿</li><li>å£°æ˜å¼ç¼“å­˜ï¼šåŸºäº Spring Cache æ¡†æ¶çš„ <code>@Cacheable</code> ç­‰ç­‰æ³¨è§£</li></ul><h2 id="_1-ç¼–ç¨‹å¼ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-ç¼–ç¨‹å¼ç¼“å­˜" aria-hidden="true">#</a> 1. ç¼–ç¨‹å¼ç¼“å­˜</h2><p>å¼•å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº Redisson æä¾›äº†åˆ†å¸ƒå¼é”ã€é˜Ÿåˆ—ã€é™æµç­‰ç‰¹æ€§ï¼Œæ‰€ä»¥ä½¿ç”¨å®ƒä½œä¸º Spring Data Redis çš„å®¢æˆ·ç«¯ã€‚</p><h3 id="_1-1-spring-data-redis-é…ç½®" tabindex="-1"><a class="header-anchor" href="#_1-1-spring-data-redis-é…ç½®" aria-hidden="true">#</a> 1.1 Spring Data Redis é…ç½®</h3><p>â‘  åœ¨ <code>application-local.yaml</code>é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ <code>spring.redis</code> é…ç½®é¡¹ï¼Œè®¾ç½® Redis çš„é…ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="`+l+`" alt="Snipaste_2023-06-14_18-58-06"></p><p>â‘¡ åœ¨ KaysonRedisAutoConfiguration é…ç½®ç±»ï¼Œè®¾ç½®ä½¿ç”¨ JSON åºåˆ—åŒ– value å€¼ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@AutoConfiguration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KaysonRedisAutoConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">;</span>
    
    <span class="token doc-comment comment">/**
     * åˆ›å»º RedisTemplate Beanï¼Œä½¿ç”¨ JSON åºåˆ—åŒ–æ–¹å¼
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»º RedisTemplate å¯¹è±¡</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è®¾ç½® RedisConnection å·¥å‚ã€‚ğŸ˜ˆ å®ƒå°±æ˜¯å®ç°å¤šç§ Java Redis å®¢æˆ·ç«¯æ¥å…¥çš„ç§˜å¯†å·¥å‚ã€‚</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä½¿ç”¨ String åºåˆ—åŒ–æ–¹å¼ï¼Œåºåˆ—åŒ– KEY</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ä½¿ç”¨ JSON åºåˆ—åŒ–æ–¹å¼ï¼ˆåº“æ˜¯ Jackson ï¼‰ï¼Œåºåˆ—åŒ– VALUE</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-2redis-key-å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_1-2redis-key-å®šä¹‰" aria-hidden="true">#</a> 1.2Redis Key å®šä¹‰</h3>`,11),b={href:"https://gitee.com/jhzhou/kayson/blob/master/kayson-framework/kayson-spring-boot-starter-redis/src/main/java/cn/zjh/kayson/framework/redis/core/RedisKeyDefine.java",target:"_blank",rel:"noopener noreferrer"},g={class:"custom-container tip"},f=n("p",{class:"custom-container-title"},"æç¤º:",-1),_=n("li",null,"â‘  å¦‚æœå€¼æ˜¯ã€ç®€å•ã€‘çš„ String æˆ–è€… Integer ç­‰ç±»å‹ï¼Œæ— éœ€åˆ›å»ºæ•°æ®å®ä½“ã€‚",-1),y=n("code",null,"dal/dataobject",-1),R={href:"https://gitee.com/jhzhou/kayson/blob/master/kayson-module-system/kayson-module-system-biz/src/main/java/cn/zjh/kayson/module/system/dal/dataobject/oauth2/OAuth2AccessTokenDO.java",target:"_blank",rel:"noopener noreferrer"},C=t(`<h3 id="_1-3rediskeyconstants" tabindex="-1"><a class="header-anchor" href="#_1-3rediskeyconstants" aria-hidden="true">#</a> 1.3RedisKeyConstants</h3><div class="custom-container tip"><p class="custom-container-title">ä¸ºä»€ä¹ˆè¦å®šä¹‰ Redis Key å¸¸é‡ï¼Ÿ</p><p>æ¯ä¸ª <code>kayson-module-xxx</code> æ¨¡å—ï¼Œéƒ½æœ‰ä¸€ä¸ª RedisKeyConstants ç±»ï¼Œå®šä¹‰è¯¥æ¨¡å—çš„ Redis Key çš„ä¿¡æ¯ã€‚ç›®çš„æ˜¯ï¼Œé¿å… Redis Key æ•£è½åœ¨ Service ä¸šåŠ¡ä»£ç ä¸­ï¼Œåƒå¯¹å¾…æ•°æ®åº“çš„è¡¨ä¸€æ ·ï¼Œå¯¹å¾…æ¯ä¸ª Redis Keyã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦äº†è§£ä¸€ä¸ªæ¨¡å—çš„ Redis çš„ä½¿ç”¨æƒ…å†µï¼Œåªéœ€è¦æŸ¥çœ‹ RedisKeyConstants ç±»å³å¯ã€‚</p></div><p>åœ¨ <code>kayson-module-system</code> æ¨¡å—çš„ RedisKeyConstants ç±»ä¸­ï¼Œåˆ›å»ºäº† OAuth2AccessTokenDO å¯¹åº”çš„ Redis Key å®šä¹‰ <code>OAUTH2_ACCESS_TOKEN</code>ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * System Redis Key æšä¸¾ç±»
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RedisKeyConstants</span> <span class="token punctuation">{</span>
    
    <span class="token class-name">RedisKeyDefine</span> <span class="token constant">OAUTH2_ACCESS_TOKEN</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisKeyDefine</span><span class="token punctuation">(</span><span class="token string">&quot;è®¿é—®ä»¤ç‰Œçš„ç¼“å­˜&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;oauth2_access_token:%s&quot;</span><span class="token punctuation">,</span> <span class="token comment">// å‚æ•°ä¸ºè®¿é—®ä»¤ç‰Œ token</span>
            <span class="token class-name">RedisKeyDefine<span class="token punctuation">.</span>KeyTypeEnum</span><span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
            <span class="token class-name">OAuth2AccessTokenDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> 
            <span class="token class-name">RedisKeyDefine<span class="token punctuation">.</span>TimeoutTypeEnum</span><span class="token punctuation">.</span><span class="token constant">DYNAMIC</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-4oauth2accesstokenredisdao" tabindex="-1"><a class="header-anchor" href="#_1-4oauth2accesstokenredisdao" aria-hidden="true">#</a> 1.4OAuth2AccessTokenRedisDAO</h3><p>OAuth2AccessTokenRedisDAO ç±»ï¼Œæ˜¯ OAuth2AccessTokenDO çš„ RedisDAO å®ç°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OAuth2AccessTokenRedisDAO</span> <span class="token punctuation">{</span>
    
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">OAuth2AccessTokenDO</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> accessToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token function">formatKey</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">OAuth2AccessTokenDO</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">OAuth2AccessTokenDO</span> accessTokenDO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token function">formatKey</span><span class="token punctuation">(</span>accessTokenDO<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¸…ç†å¤šä½™å­—æ®µï¼Œé¿å…ç¼“å­˜</span>
        accessTokenDO<span class="token punctuation">.</span><span class="token function">setUpdater</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUpdateTime</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCreator</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDeleted</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> time <span class="token operator">=</span> <span class="token class-name">LocalDateTimeUtil</span><span class="token punctuation">.</span><span class="token function">between</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> accessTokenDO<span class="token punctuation">.</span><span class="token function">getExpiresTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ChronoUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">,</span> <span class="token class-name">JsonUtils</span><span class="token punctuation">.</span><span class="token function">toJsonString</span><span class="token punctuation">(</span>accessTokenDO<span class="token punctuation">)</span><span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> accessToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> redisKey <span class="token operator">=</span> <span class="token function">formatKey</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>redisKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteList</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> accessTokens<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> redisKeys <span class="token operator">=</span> <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">convertList</span><span class="token punctuation">(</span>accessTokens<span class="token punctuation">,</span> <span class="token class-name">OAuth2AccessTokenRedisDAO</span><span class="token operator">::</span><span class="token function">formatKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        stringRedisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>redisKeys<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">formatKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> accessToken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token constant">OAUTH2_ACCESS_TOKEN</span><span class="token punctuation">.</span><span class="token function">getKeyTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_1-5ä½¿ç”¨" aria-hidden="true">#</a> 1.5ä½¿ç”¨</h3><p>åªéœ€åœ¨ç±»ä¸­å¼•å…¥ OAuth2AccessTokenRedisDAO Beanï¼Œå°±å¯ä»¥éå¸¸ç®€æ´å¹²å‡€çš„è¿›è¡Œ OAuth2AccessTokenDO çš„ç¼“å­˜æ“ä½œï¼Œæ— éœ€å…³å¿ƒå…·ä½“çš„å®ç°ã€‚</p><p><img src="`+u+`" alt="Snipaste_2023-06-14_19-14-37"></p><h2 id="_2-å£°æ˜å¼ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_2-å£°æ˜å¼ç¼“å­˜" aria-hidden="true">#</a> 2. å£°æ˜å¼ç¼“å­˜</h2><p>å¼•å…¥ä¾èµ–</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç›¸æ¯”æ¥è¯´ Spring Data Redis ç¼–ç¨‹å¼ç¼“å­˜ï¼ŒSpring Cache å£°æ˜å¼ç¼“å­˜çš„ä½¿ç”¨æ›´åŠ ä¾¿åˆ©ï¼Œä¸€ä¸ª <code>@Cacheable</code> æ³¨è§£å³å¯å®ç°ç¼“å­˜çš„åŠŸèƒ½ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;users&quot;</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">&quot;#id&quot;</span><span class="token punctuation">)</span>
<span class="token class-name">UserDO</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1-spring-cache-é…ç½®" tabindex="-1"><a class="header-anchor" href="#_2-1-spring-cache-é…ç½®" aria-hidden="true">#</a> 2.1 Spring Cache é…ç½®</h3><p>â‘  åœ¨ application.yaml é…ç½®æ–‡ä»¶ä¸­ï¼Œé€šè¿‡ spring.redis é…ç½®é¡¹ï¼Œè®¾ç½® Redis çš„é…ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="`+r+`" alt="Snipaste_2023-06-14_19-17-30"></p><p>â‘¡ åœ¨ KaysonCacheAutoConfiguration é…ç½®ç±»ï¼Œè®¾ç½®ä½¿ç”¨ JSON åºåˆ—åŒ– value å€¼ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Cache é…ç½®ç±»ï¼ŒåŸºäº Redis å®ç°
 * 
 * <span class="token keyword">@author</span> zjh - kayson
 */</span>
<span class="token annotation punctuation">@AutoConfiguration</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">CacheProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">KaysonCacheAutoConfiguration</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/**
     * RedisCacheConfiguration Bean
     *
     * å‚è€ƒ <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">#</span><span class="token field">createConfiguration</span></span><span class="token punctuation">}</span>
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@Primary</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisCacheConfiguration</span> <span class="token function">redisCacheConfiguration</span><span class="token punctuation">(</span><span class="token class-name">CacheProperties</span> cacheProperties<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è®¾ç½®ä½¿ç”¨ JSON åºåˆ—åŒ–æ–¹å¼</span>
        <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializer</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è®¾ç½® CacheProperties.Redis çš„å±æ€§</span>
        <span class="token class-name">CacheProperties<span class="token punctuation">.</span>Redis</span> redisProperties <span class="token operator">=</span> cacheProperties<span class="token punctuation">.</span><span class="token function">getRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">prefixCacheNameWith</span><span class="token punctuation">(</span>redisProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isCacheNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisProperties<span class="token punctuation">.</span><span class="token function">isUseKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            config <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">disableKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> config<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-å¸¸è§æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_2-2-å¸¸è§æ³¨è§£" aria-hidden="true">#</a> 2.2 å¸¸è§æ³¨è§£</h3><h4 id="_2-2-1-cacheable-æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_2-2-1-cacheable-æ³¨è§£" aria-hidden="true">#</a> 2.2.1 @Cacheable æ³¨è§£</h4>`,22),T={href:"https://github.com/spring-projects/spring-framework/blob/main/spring-context/src/main/java/org/springframework/cache/annotation/Cacheable.java",target:"_blank",rel:"noopener noreferrer"},S=n("code",null,"@Cacheable",-1),w=n("ul",null,[n("li",null,"1ï¼‰é¦–å…ˆï¼Œåˆ¤æ–­æ–¹æ³•æ‰§è¡Œç»“æœçš„ç¼“å­˜ã€‚å¦‚æœæœ‰ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥ç¼“å­˜ç»“æœã€‚"),n("li",null,"2ï¼‰ç„¶åï¼Œæ‰§è¡Œæ–¹æ³•ï¼Œè·å¾—æ–¹æ³•ç»“æœã€‚"),n("li",null,"3ï¼‰ä¹‹åï¼Œæ ¹æ®æ˜¯å¦æ»¡è¶³ç¼“å­˜çš„æ¡ä»¶ã€‚å¦‚æœæ»¡è¶³ï¼Œåˆ™ç¼“å­˜æ–¹æ³•ç»“æœåˆ°ç¼“å­˜ã€‚"),n("li",null,"4ï¼‰æœ€åï¼Œè¿”å›æ–¹æ³•ç»“æœã€‚")],-1),j=n("h4",{id:"_2-2-2-cacheput-æ³¨è§£",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-2-2-cacheput-æ³¨è§£","aria-hidden":"true"},"#"),s(" 2.2.2 @CachePut æ³¨è§£")],-1),O={href:"https://github.com/spring-projects/spring-framework/blob/main/spring-context/src/main/java/org/springframework/cache/annotation/CachePut.java",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"@CachePut",-1),x=n("code",null,"@Cacheable",-1),K=n("ul",null,[n("li",null,"1ï¼‰é¦–å…ˆï¼Œæ‰§è¡Œæ–¹æ³•ï¼Œè·å¾—æ–¹æ³•ç»“æœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºæ˜¯å¦æœ‰ç¼“å­˜ï¼Œéƒ½ä¼šæ‰§è¡Œæ–¹æ³•ã€‚"),n("li",null,"2ï¼‰ç„¶åï¼Œæ ¹æ®æ˜¯å¦æ»¡è¶³ç¼“å­˜çš„æ¡ä»¶ã€‚å¦‚æœæ»¡è¶³ï¼Œåˆ™ç¼“å­˜æ–¹æ³•ç»“æœåˆ°ç¼“å­˜ã€‚"),n("li",null,"3ï¼‰æœ€åï¼Œè¿”å›æ–¹æ³•ç»“æœã€‚")],-1),D=n("h4",{id:"_2-2-3-cacheevict-æ³¨è§£",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-2-3-cacheevict-æ³¨è§£","aria-hidden":"true"},"#"),s(" 2.2.3 @CacheEvict æ³¨è§£")],-1),z={href:"https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/cache/annotation/CacheEvict.java",target:"_blank",rel:"noopener noreferrer"},P=n("code",null,"@CacheEvict",-1),E=n("h3",{id:"_2-3ä½¿ç”¨",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-3ä½¿ç”¨","aria-hidden":"true"},"#"),s(" 2.3ä½¿ç”¨")],-1),N=n("p",null,[n("img",{src:d,alt:"Snipaste_2023-06-14_19-21-44"})],-1),I=n("ul",null,[n("li",null,"ã€è¢«åŠ¨è¯»ã€‘ç›¸å¯¹èƒ½å¤Ÿä¿è¯ Redis ä¸ MySQL çš„ä¸€è‡´æ€§"),n("li",null,"ç»å¤§æ•°æ•°æ®ä¸éœ€è¦æ”¾åˆ° Redis ç¼“å­˜ä¸­ï¼Œé‡‡ç”¨ã€ä¸»åŠ¨å†™ã€‘ä¼šå°†éå¿…è¦çš„æ•°æ®è¿›è¡Œç¼“å­˜")],-1),U={class:"custom-container tip"},L=n("p",{class:"custom-container-title"},"å‹æƒ…æç¤ºï¼š",-1),V={href:"https://www.iocoder.cn/Fight/How-Redis-and-MySQL-double-write-consistency-guarantee/?yudao",target:"_blank",rel:"noopener noreferrer"},J=n("h3",{id:"_2-4-è¿‡æœŸæ—¶é—´",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-4-è¿‡æœŸæ—¶é—´","aria-hidden":"true"},"#"),s(" 2.4 è¿‡æœŸæ—¶é—´")],-1),B=n("p",null,[s("Spring Cache é»˜è®¤ä½¿ç”¨ "),n("code",null,"spring.cache.redis.time-to-live"),s(" é…ç½®é¡¹ï¼Œè®¾ç½®ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ï¼Œé¡¹ç›®é»˜è®¤ä¸º 1 å°æ—¶ã€‚")],-1),q={href:"https://juejin.cn/post/7102222578026020871",target:"_blank",rel:"noopener noreferrer"},H=n("h2",{id:"_3-redis-ç›‘æ§",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3-redis-ç›‘æ§","aria-hidden":"true"},"#"),s(" 3. Redis ç›‘æ§")],-1),F={href:"https://gitee.com/jhzhou/kayson/blob/master/kayson-module-infra/kayson-module-infra-biz/src/main/java/cn/zjh/kayson/module/infra/controller/admin/redis/RedisController.java",target:"_blank",rel:"noopener noreferrer"},M=n("p",null,"ç‚¹å‡» [åŸºç¡€è®¾æ–½ -> Redis ç›‘æ§] èœå•ï¼Œå¯ä»¥æŸ¥çœ‹åˆ° Redis çš„åŸºç¡€ä¿¡æ¯ã€å‘½ä»¤ç»Ÿè®¡ã€å†…å­˜ä¿¡æ¯ã€‚",-1);function Q(W,Y){const a=o("ExternalLinkIcon");return c(),i("div",null,[m,n("p",null,[n("a",v,[s("kayson-spring-boot-starter-redis"),e(a)]),s(" æŠ€æœ¯ç»„ä»¶ï¼Œä½¿ç”¨ Redis å®ç°ç¼“å­˜çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ 2 ç§ä½¿ç”¨æ–¹å¼ï¼š")]),h,n("p",null,[s("é€šè¿‡ "),n("a",b,[s("RedisKeyDefine"),e(a)]),s(" ç±»å®šä¹‰ Redis Key")]),n("div",g,[f,n("ul",null,[_,n("li",null,[s("â‘¡ å¦‚æœå€¼æ˜¯ã€å¤æ‚å¯¹è±¡ã€‘æ—¶ï¼Œå»ºè®®åœ¨ "),y,s(" åŒ…ä¸‹ï¼Œåˆ›å»ºå¯¹åº”çš„æ•°æ®å®ä½“ï¼Œä¾‹å¦‚è¯´è®¿é—®ä»¤ç‰Œ Access Token ç±» "),n("a",R,[s("OAuth2AccessTokenDO"),e(a)]),s("ã€‚")])])]),C,n("p",null,[n("a",T,[S,s(),e(a)]),s("æ³¨è§£ï¼šæ·»åŠ åœ¨æ–¹æ³•ä¸Šï¼Œç¼“å­˜æ–¹æ³•çš„æ‰§è¡Œç»“æœã€‚æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š")]),w,j,n("p",null,[n("a",O,[A,s(),e(a)]),s("æ³¨è§£ï¼Œæ·»åŠ åœ¨æ–¹æ³•ä¸Šï¼Œç¼“å­˜æ–¹æ³•çš„æ‰§è¡Œç»“æœã€‚ä¸åŒäº "),x,s(" æ³¨è§£ï¼Œå®ƒçš„æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š")]),K,D,n("p",null,[n("a",z,[P,e(a)]),s("æ³¨è§£ï¼Œæ·»åŠ åœ¨æ–¹æ³•ä¸Šï¼Œåˆ é™¤ç¼“å­˜ã€‚")]),E,N,I,n("div",U,[L,n("p",null,[s("å¦‚æœä½ æœªå­¦ä¹ è¿‡ MySQL ä¸ Redis ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå¯ä»¥åç»­é˜…è¯» "),n("a",V,[s("ã€ŠRedis ä¸ MySQL åŒå†™ä¸€è‡´æ€§å¦‚ä½•ä¿è¯ï¼Ÿ ã€‹"),e(a)]),s("æ–‡ç« ã€‚")])]),J,B,n("p",null,[s("å¦‚æœä½ æƒ³è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´ï¼Œå¯å‚è€ƒ "),n("a",q,[s("ã€ŠSpring @Cacheable æ‰©å±•æ”¯æŒè‡ªå®šä¹‰è¿‡æœŸæ—¶é—´ ã€‹"),e(a)]),s(" æ–‡ç« ã€‚")]),H,n("p",null,[s("kayson-module-infra çš„ redis æ¨¡å—ä¸­ "),n("a",F,[s("RedisController"),e(a)]),s("ï¼Œæä¾›äº† Redis ç›‘æ§çš„åŠŸèƒ½ã€‚")]),M])}const X=p(k,[["render",Q],["__file","Redisç¼“å­˜.html.vue"]]);export{X as default};
