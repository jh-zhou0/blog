<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/favicon.ico"><title>RocketMQ部署指南 | 空山木巷</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-90eac310.css" as="style"><link rel="stylesheet" href="/blog/assets/style-90eac310.css">
    <link rel="modulepreload" href="/blog/assets/app-66d6b4fd.js"><link rel="modulepreload" href="/blog/assets/RocketMQ部署指南.html-73952eb6.js"><link rel="modulepreload" href="/blog/assets/RocketMQ部署指南.html-34d27c15.js"><link rel="prefetch" href="/blog/assets/index.html-33f7dfbb.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-99ca016c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-67c923f9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-c0e7ceff.js" as="script"><link rel="prefetch" href="/blog/assets/Redis缓存.html-988c20bf.js" as="script"><link rel="prefetch" href="/blog/assets/SaaS多租户.html-0b4298a2.js" as="script"><link rel="prefetch" href="/blog/assets/功能权限.html-1a5bbea9.js" as="script"><link rel="prefetch" href="/blog/assets/幂等性（防重复提交）.html-43a94299.js" as="script"><link rel="prefetch" href="/blog/assets/数据库 MyBatis.html-0283d0f0.js" as="script"><link rel="prefetch" href="/blog/assets/数据权限.html-06e84b51.js" as="script"><link rel="prefetch" href="/blog/assets/本地缓存.html-b0021a15.js" as="script"><link rel="prefetch" href="/blog/assets/消息队列.html-b31ff32c.js" as="script"><link rel="prefetch" href="/blog/assets/用户认证.html-9edb96f7.js" as="script"><link rel="prefetch" href="/blog/assets/系统日志.html-6f65c9c7.js" as="script"><link rel="prefetch" href="/blog/assets/统一响应和异常处理（错误码）.html-48753ae0.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-4751f011.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-f3cba283.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQL常用的命令.html-ee92d52b.js" as="script"><link rel="prefetch" href="/blog/assets/13-责任链模式.html-ecb3744d.js" as="script"><link rel="prefetch" href="/blog/assets/14-命令模式.html-5eb58d88.js" as="script"><link rel="prefetch" href="/blog/assets/15-解析器模式.html-96606363.js" as="script"><link rel="prefetch" href="/blog/assets/16-迭代器模式.html-8ebf1e59.js" as="script"><link rel="prefetch" href="/blog/assets/17-中介者模式.html-a0f26b82.js" as="script"><link rel="prefetch" href="/blog/assets/18-备忘录模式.html-37ec7801.js" as="script"><link rel="prefetch" href="/blog/assets/19-观察者模式.html-68ace6a1.js" as="script"><link rel="prefetch" href="/blog/assets/20-状态模式.html-a5f78c82.js" as="script"><link rel="prefetch" href="/blog/assets/21-策略模式.html-a0ea40f7.js" as="script"><link rel="prefetch" href="/blog/assets/22-模板方法模式.html-f1f66b72.js" as="script"><link rel="prefetch" href="/blog/assets/23-访问者模式.html-cd09056c.js" as="script"><link rel="prefetch" href="/blog/assets/1-单例模式.html-5e97ccb1.js" as="script"><link rel="prefetch" href="/blog/assets/2-抽象工厂模式.html-2a70948c.js" as="script"><link rel="prefetch" href="/blog/assets/3-工厂方法模式.html-88c631dd.js" as="script"><link rel="prefetch" href="/blog/assets/4-建造者模式.html-210f3d70.js" as="script"><link rel="prefetch" href="/blog/assets/5-原型模式.html-e37c22fb.js" as="script"><link rel="prefetch" href="/blog/assets/10-桥接模式.html-bb899021.js" as="script"><link rel="prefetch" href="/blog/assets/11-组合模式.html-608f7edb.js" as="script"><link rel="prefetch" href="/blog/assets/12-享元模式.html-7eb14c96.js" as="script"><link rel="prefetch" href="/blog/assets/6-适配器模式.html-42ada3ad.js" as="script"><link rel="prefetch" href="/blog/assets/7-装饰器模式.html-8765fae1.js" as="script"><link rel="prefetch" href="/blog/assets/8-外观模式.html-0103ad00.js" as="script"><link rel="prefetch" href="/blog/assets/9-代理模式.html-72f08df8.js" as="script"><link rel="prefetch" href="/blog/assets/UML类图.html-56387884.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8新特性概述.html-adb6e16e.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream API的中间操作.html-dcbf3f12.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream API的终止操作.html-cc9d125f.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optional类.html-c4d2ef31.js" as="script"><link rel="prefetch" href="/blog/assets/13-接口中的默认方法和静态方法.html-f470ea46.js" as="script"><link rel="prefetch" href="/blog/assets/14-新日期时间API.html-dcbed7d9.js" as="script"><link rel="prefetch" href="/blog/assets/15-重复注解与类型注解.html-f2f3eca7.js" as="script"><link rel="prefetch" href="/blog/assets/2-引入Lambda表达式.html-e6241b21.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambda表达式基础语法.html-26b78f6c.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambda表达式典型案例.html-0dca302e.js" as="script"><link rel="prefetch" href="/blog/assets/5-函数式接口.html-95fa5e28.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7和Java8的HashMap.html-1eb0c9da.js" as="script"><link rel="prefetch" href="/blog/assets/7-方法引用和构造器引用.html-f6d10b42.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream API基础.html-90d2d127.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream API的创建案例.html-1f13fad9.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ入门.html-c20c90f0.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ部署指南.html-6d5dea63.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ高级.html-713abb8b.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ简介.html-df81724a.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ问题与解决.html-c596414a.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQ入门.html-d4ef1d3d.js" as="script"><link rel="prefetch" href="/blog/assets/Docker安装.html-299af5cc.js" as="script"><link rel="prefetch" href="/blog/assets/Docker实用篇.html-52d0916d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e263db13.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-9dd24a6d.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-0d946030.js" as="script"><link rel="prefetch" href="/blog/assets/Linux虚拟机克隆.html-b438ca2c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-dd625d67.js" as="script"><link rel="prefetch" href="/blog/assets/VMware安装CentOS7.html-a73884c0.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-e2ad7188.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-794c1916.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-98e4866e.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-2fb772ff.js" as="script"><link rel="prefetch" href="/blog/assets/Redis缓存.html-bd0daed9.js" as="script"><link rel="prefetch" href="/blog/assets/SaaS多租户.html-a2055fe0.js" as="script"><link rel="prefetch" href="/blog/assets/功能权限.html-2d8aaacc.js" as="script"><link rel="prefetch" href="/blog/assets/幂等性（防重复提交）.html-0534ba04.js" as="script"><link rel="prefetch" href="/blog/assets/数据库 MyBatis.html-e382d2a7.js" as="script"><link rel="prefetch" href="/blog/assets/数据权限.html-a5caa49b.js" as="script"><link rel="prefetch" href="/blog/assets/本地缓存.html-f2290b7c.js" as="script"><link rel="prefetch" href="/blog/assets/消息队列.html-a6146d9a.js" as="script"><link rel="prefetch" href="/blog/assets/用户认证.html-9d064fff.js" as="script"><link rel="prefetch" href="/blog/assets/系统日志.html-ee40ac2f.js" as="script"><link rel="prefetch" href="/blog/assets/统一响应和异常处理（错误码）.html-6de026fa.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-31a96e3c.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-a6895b4b.js" as="script"><link rel="prefetch" href="/blog/assets/1-MySQL常用的命令.html-ca808bbc.js" as="script"><link rel="prefetch" href="/blog/assets/13-责任链模式.html-37bc270e.js" as="script"><link rel="prefetch" href="/blog/assets/14-命令模式.html-565f0606.js" as="script"><link rel="prefetch" href="/blog/assets/15-解析器模式.html-a1e4bfaa.js" as="script"><link rel="prefetch" href="/blog/assets/16-迭代器模式.html-ead46aeb.js" as="script"><link rel="prefetch" href="/blog/assets/17-中介者模式.html-701b63f8.js" as="script"><link rel="prefetch" href="/blog/assets/18-备忘录模式.html-8cf3d53a.js" as="script"><link rel="prefetch" href="/blog/assets/19-观察者模式.html-dfb01611.js" as="script"><link rel="prefetch" href="/blog/assets/20-状态模式.html-e26f4307.js" as="script"><link rel="prefetch" href="/blog/assets/21-策略模式.html-27dc7c89.js" as="script"><link rel="prefetch" href="/blog/assets/22-模板方法模式.html-6eb9e5b2.js" as="script"><link rel="prefetch" href="/blog/assets/23-访问者模式.html-cf79916d.js" as="script"><link rel="prefetch" href="/blog/assets/1-单例模式.html-89e83bdd.js" as="script"><link rel="prefetch" href="/blog/assets/2-抽象工厂模式.html-f9ba82fa.js" as="script"><link rel="prefetch" href="/blog/assets/3-工厂方法模式.html-716e2ec4.js" as="script"><link rel="prefetch" href="/blog/assets/4-建造者模式.html-f9c85e95.js" as="script"><link rel="prefetch" href="/blog/assets/5-原型模式.html-c346c412.js" as="script"><link rel="prefetch" href="/blog/assets/10-桥接模式.html-58973dc7.js" as="script"><link rel="prefetch" href="/blog/assets/11-组合模式.html-8845d578.js" as="script"><link rel="prefetch" href="/blog/assets/12-享元模式.html-4f0564d0.js" as="script"><link rel="prefetch" href="/blog/assets/6-适配器模式.html-ee4a3eab.js" as="script"><link rel="prefetch" href="/blog/assets/7-装饰器模式.html-9da2ce9b.js" as="script"><link rel="prefetch" href="/blog/assets/8-外观模式.html-de9ba17f.js" as="script"><link rel="prefetch" href="/blog/assets/9-代理模式.html-24224643.js" as="script"><link rel="prefetch" href="/blog/assets/UML类图.html-ee48f6ee.js" as="script"><link rel="prefetch" href="/blog/assets/1-Java8新特性概述.html-ba7370a2.js" as="script"><link rel="prefetch" href="/blog/assets/10-Stream API的中间操作.html-ab41c503.js" as="script"><link rel="prefetch" href="/blog/assets/11-Stream API的终止操作.html-579e0275.js" as="script"><link rel="prefetch" href="/blog/assets/12-Optional类.html-2938f6c0.js" as="script"><link rel="prefetch" href="/blog/assets/13-接口中的默认方法和静态方法.html-4376d340.js" as="script"><link rel="prefetch" href="/blog/assets/14-新日期时间API.html-8cef1169.js" as="script"><link rel="prefetch" href="/blog/assets/15-重复注解与类型注解.html-14c69dac.js" as="script"><link rel="prefetch" href="/blog/assets/2-引入Lambda表达式.html-cbb68b73.js" as="script"><link rel="prefetch" href="/blog/assets/3-Lambda表达式基础语法.html-b874571a.js" as="script"><link rel="prefetch" href="/blog/assets/4-Lambda表达式典型案例.html-02ff3862.js" as="script"><link rel="prefetch" href="/blog/assets/5-函数式接口.html-a567c93c.js" as="script"><link rel="prefetch" href="/blog/assets/6-Java7和Java8的HashMap.html-d45c19ee.js" as="script"><link rel="prefetch" href="/blog/assets/7-方法引用和构造器引用.html-5528bf63.js" as="script"><link rel="prefetch" href="/blog/assets/8-Stream API基础.html-716d9e0b.js" as="script"><link rel="prefetch" href="/blog/assets/9-Stream API的创建案例.html-f8bfe8bc.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ入门.html-aa90e61e.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ部署指南.html-ae39e5df.js" as="script"><link rel="prefetch" href="/blog/assets/RabbitMQ高级.html-ff1c439e.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ简介.html-734c9b0f.js" as="script"><link rel="prefetch" href="/blog/assets/RocketMQ问题与解决.html-2b150a6b.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot RocketMQ入门.html-25974b8e.js" as="script"><link rel="prefetch" href="/blog/assets/Docker安装.html-a0389f48.js" as="script"><link rel="prefetch" href="/blog/assets/Docker实用篇.html-ad5b2634.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3cba7701.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-646aeed4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-d3ddc6e3.js" as="script"><link rel="prefetch" href="/blog/assets/Linux虚拟机克隆.html-32214cd3.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-cdeca630.js" as="script"><link rel="prefetch" href="/blog/assets/VMware安装CentOS7.html-4cd1bd26.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-d672d3fd.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/blog/" class=""><img class="logo" src="/blog/images/logo.png" alt="空山木巷"><span class="site-name can-hide">空山木巷</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8新特性概述.md" class="" aria-label="java8新特性"><!--[--><!--]--> java8新特性 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/分布式事务.md" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQL常用的命令.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-单例模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="router-link-active" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/blog/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="工具"><span class="title">工具</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="工具"><span class="title">工具</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>容器服务</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/linux/" class="" aria-label="Linux"><!--[--><!--]--> Linux <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/docker/" class="" aria-label="Docker"><!--[--><!--]--> Docker <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>开发工具</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/blog/tool/git/" class="" aria-label="Git"><!--[--><!--]--> Git <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/blog/tool/idea/" class="" aria-label="IDEA"><!--[--><!--]--> IDEA <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/java/java8/1-Java8新特性概述.md" class="" aria-label="java8新特性"><!--[--><!--]--> java8新特性 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="分布式"><span class="title">分布式</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="分布式"><span class="title">分布式</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/distributed/分布式事务.md" class="" aria-label="分布式事务"><!--[--><!--]--> 分布式事务 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/blog/db/mysql/1-MySQL常用的命令.md" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/blog/design-patterns/creational/1-单例模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/mq/" class="router-link-active" aria-label="消息队列"><!--[--><!--]--> 消息队列 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/kayson/" class="" aria-label="Kayson"><!--[--><!--]--> Kayson <!--[--><!--]--></a></div><div class="navbar-item"><a href="/blog/seckill/" class="" aria-label="Seckill"><!--[--><!--]--> Seckill <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://gitee.com/jhzhou" rel="noopener noreferrer" target="_blank" aria-label="Gitee"><!--[--><!--]--> Gitee <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jh-zhou0" rel="noopener noreferrer" target="_blank" aria-label="Github"><!--[--><!--]--> Github <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">RabbitMQ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/mq/rabbitmq/RabbitMQ部署指南.md" class="sidebar-item" aria-label="RabbitMQ部署指南"><!--[--><!--]--> RabbitMQ部署指南 <!--[--><!--]--></a><!----></li><li><a href="/blog/mq/rabbitmq/RabbitMQ入门.md" class="sidebar-item" aria-label="RabbitMQ入门"><!--[--><!--]--> RabbitMQ入门 <!--[--><!--]--></a><!----></li><li><a href="/blog/mq/rabbitmq/RabbitMQ高级.md" class="sidebar-item" aria-label="RabbitMQ高级"><!--[--><!--]--> RabbitMQ高级 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active">RocketMQ <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/blog/mq/rocketmq/RocketMQ部署指南.md" class="sidebar-item active" aria-label="RocketMQ部署指南"><!--[--><!--]--> RocketMQ部署指南 <!--[--><!--]--></a><!----></li><li><a href="/blog/mq/rocketmq/RocketMQ简介.md" class="sidebar-item" aria-label="RocketMQ简介"><!--[--><!--]--> RocketMQ简介 <!--[--><!--]--></a><!----></li><li><a href="/blog/mq/rocketmq/SpringBoot RocketMQ入门.md" class="sidebar-item" aria-label="SpringBoot RocketMQ入门"><!--[--><!--]--> SpringBoot RocketMQ入门 <!--[--><!--]--></a><!----></li><li><a href="/blog/mq/rocketmq/RocketMQ问题与解决.md" class="sidebar-item" aria-label="RocketMQ问题与解决"><!--[--><!--]--> RocketMQ问题与解决 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading">Kafka <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="rocketmq部署指南" tabindex="-1"><a class="header-anchor" href="#rocketmq部署指南" aria-hidden="true">#</a> RocketMQ部署指南</h1><h2 id="_1-docker单机部署" tabindex="-1"><a class="header-anchor" href="#_1-docker单机部署" aria-hidden="true">#</a> 1.Docker单机部署</h2><p>镜像地址：<a href="https://hub.docker.com/r/apache/rocketmq/tags" target="_blank" rel="noopener noreferrer">apache/rocketmq Tags | Docker Hub<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_1-1拉取镜像" tabindex="-1"><a class="header-anchor" href="#_1-1拉取镜像" aria-hidden="true">#</a> 1.1拉取镜像</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 最新版本</span>
<span class="token function">docker</span> pull apache/rocketmq:5.1.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>查看镜像信息</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> images
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_1-2部署nameserver" tabindex="-1"><a class="header-anchor" href="#_1-2部署nameserver" aria-hidden="true">#</a> 1.2部署NameServer</h3><p>NameServer是一个简单的 <a href="https://so.csdn.net/so/search?q=Topic&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">Topic<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> 路由注册中心，支持 Topic、Broker 的动态注册与发现，几乎无状态节点，因此可集群部署，节点之间无任何信息同步，所谓的集群部署和单机部署其实是一样的，需要多个NameServer保持高可用只需独立部署即可。</p><h4 id="创建挂载文件夹" tabindex="-1"><a class="header-anchor" href="#创建挂载文件夹" aria-hidden="true">#</a> 创建挂载文件夹</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 日志目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/nameserver/logs
<span class="token comment"># 脚本目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/nameserver/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="设置权限" tabindex="-1"><a class="header-anchor" href="#设置权限" aria-hidden="true">#</a> 设置权限</h4><p>如果不设置会导致NameServer容器内部无法写日志文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 777 文件所属者、文件所属组和其他人有 [读取 &amp; 写入 &amp; 执行]全部权限。rwxrwxrwx</span>
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /tmp/rocketmq/nameserver/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="修改启动脚本" tabindex="-1"><a class="header-anchor" href="#修改启动脚本" aria-hidden="true">#</a> 修改启动脚本</h4><p>NameServer启动脚本中有一个自动计算最大堆内存和新生代内存的函数会导致在不同硬件环境下设置最大堆内存和新生代内存环境变量不被应用，这里先提前copy一份容器内部启动脚本做挂载，如果想自定义内存可以自己调整。（如果不需要自定义堆内存可以跳过）</p><ol><li>启动容器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqnamesrv <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>复制容器内启动脚本到挂载目录 /tmp/rocketmq/nameserver/bin</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> rmqnamesrv:/home/rocketmq/rocketmq-5.1.1/bin/runserver.sh /tmp/rocketmq/nameserver/bin/runserver.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>修改runserver.sh，找到调用 <code>calculate_heap_sizes</code> 函数的位置注释掉保存即可</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 打开脚本文件</span>
<span class="token function">vi</span> /tmp/rocketmq/nameserver/bin/runserver.sh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>停止&amp;删除容器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop rmqnamesrv
<span class="token function">docker</span> <span class="token function">rm</span> rmqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动nameserver" tabindex="-1"><a class="header-anchor" href="#启动nameserver" aria-hidden="true">#</a> 启动NameServer</h4><ul><li>不需要自定义堆内存</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqnamesrv <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9876</span>:9876  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/nameserver/logs:/home/rocketmq/logs <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>需要自定义堆内存</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqnamesrv <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9876</span>:9876  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/nameserver/logs:/home/rocketmq/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/nameserver/bin/runserver.sh:/home/rocketmq/rocketmq-5.1.1/bin/runserver.sh <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_HEAP_SIZE=256M&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;HEAP_NEWSIZE=128M&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>参数说明</strong>：</p><table><thead><tr><th><strong>参数</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>-d</td><td>以守护进程的方式启动</td></tr><tr><td>--privileged=true</td><td>docker容器 获取宿主机root权限（特殊权限）</td></tr><tr><td>--restart=always</td><td>docker重启时候容器自动重启</td></tr><tr><td>--name rmqnamesrv</td><td>容器名</td></tr><tr><td>-p 9876:9876</td><td>把容器内的端口9876挂载到宿主机9876上面，宿主机端口:容器内部端口</td></tr><tr><td>-v /tmp/rocketmq/nameserver/logs:/home/rocketmq/logs</td><td>挂载容器内日志</td></tr><tr><td>-v /tmp/rocketmq/nameserver/bin/runserver.sh:/home/rocketmq/rocketmq-latest/bin/runserver.sh</td><td>挂载启动脚本（需要自己定义堆内存时使用）</td></tr><tr><td>-e “MAX_HEAP_SIZE=256M”</td><td>设置最大堆内存和堆内存初始大小</td></tr><tr><td>-e “HEAP_NEWSIZE=128M”</td><td>设置新生代内存大小</td></tr><tr><td>apache/rocketmq:5.1.1</td><td>使用的镜像名称+版本</td></tr><tr><td>使用的镜像名称+版本</td><td>启动namesrv服务</td></tr></tbody></table><h3 id="_1-3部署broker" tabindex="-1"><a class="header-anchor" href="#_1-3部署broker" aria-hidden="true">#</a> 1.3部署Broker</h3><h4 id="创建需要映射的文件夹和文件" tabindex="-1"><a class="header-anchor" href="#创建需要映射的文件夹和文件" aria-hidden="true">#</a> 创建需要映射的文件夹和文件</h4><p>提前创建挂载目录用于挂载容器内部数据、配置文件、以及日志</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建需要的挂载目录</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker/logs <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker/data <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker/conf <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="设置权限-1" tabindex="-1"><a class="header-anchor" href="#设置权限-1" aria-hidden="true">#</a> 设置权限</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 777 文件所属者、文件所属组和其他人有 [读取 &amp; 写入 &amp; 执行]全部权限。rwxrwxrwx</span>
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /tmp/rocketmq/broker/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建broker-conf文件" tabindex="-1"><a class="header-anchor" href="#创建broker-conf文件" aria-hidden="true">#</a> 创建broker.conf文件</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /tmp/rocketmq/broker/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>添加以下配置信息到broker.conf，这里不对参数做过多的说明，在下面Broker配置详解中有对Broker常用参数做详细介绍</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameServer 地址多个用;隔开 默认值null</span>
<span class="token comment"># 例：127.0.0.1:6666;127.0.0.1:8888 </span>
namesrvAddr <span class="token operator">=</span> <span class="token number">192.168</span>.100.100:9876
<span class="token comment"># 集群名称</span>
brokerClusterName <span class="token operator">=</span> DefaultCluster
<span class="token comment"># 节点名称</span>
brokerName <span class="token operator">=</span> broker-a
<span class="token comment"># broker id节点ID， 0 表示 master, 其他的正整数表示 slave，不能小于0 </span>
brokerId <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># Broker服务地址 String	内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP1 <span class="token operator">=</span> <span class="token number">192.168</span>.100.100
<span class="token comment"># Broker角色</span>
brokerRole <span class="token operator">=</span> ASYNC_MASTER
<span class="token comment"># 刷盘方式</span>
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token comment"># 在每天的什么时间删除已经超过文件保留时间的 commit log，默认值04</span>
deleteWhen <span class="token operator">=</span> 04
<span class="token comment"># 以小时计算的文件保留时间 默认值72小时</span>
fileReservedTime <span class="token operator">=</span> <span class="token number">72</span>
<span class="token comment"># 是否允许Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment"># 是否允许Broker自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：建立broker.conf文件，通过这个文件把RocketMQ的broker管理起来</p><h4 id="修改broker启动脚本" tabindex="-1"><a class="header-anchor" href="#修改broker启动脚本" aria-hidden="true">#</a> 修改Broker启动脚本</h4><p>Broker启动脚本中有一个自动计算最大堆内存和新生代内存的函数会导致在不同硬件环境下设置最大堆内存和新生代内存环境变量不被应用，这里先提前copy一份容器内部启动脚本做挂载，如果想自定义内存可以自己调整。（如果不需要自定义堆内存可以跳过）</p><ol><li>启动容器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>复制容器内启动脚本到挂载目录/tmp/rocketmq/nameserver/bin</li></ol><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>docker cp rmqbroker:/home/rocketmq/rocketmq-5.1.1/bin/runbroker.sh /tmp/rocketmq/broker/bin/runbroker.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>修改runbroker.sh，找到调用calculate_heap_sizes函数的位置注释掉保存即可</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 打开脚本文件</span>
<span class="token function">vi</span> /usr/local/rocketmq/broker/bin/runbroker.sh 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>停止&amp;删除容器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> stop rmqbroker
<span class="token function">docker</span> <span class="token function">rm</span> rmqbroker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动broker-proxy" tabindex="-1"><a class="header-anchor" href="#启动broker-proxy" aria-hidden="true">#</a> 启动Broker+Proxy</h4><ul><li>不需要自定义堆内存</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10911</span>:10911 <span class="token parameter variable">-p</span> <span class="token number">10909</span>:10909 <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/conf/broker.conf:/home/rocketmq/broker.conf <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /home/rocketmq/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>需要自定义堆内存</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10911</span>:10911 <span class="token parameter variable">-p</span> <span class="token number">10909</span>:10909 <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/conf/broker.conf:/home/rocketmq/broker.conf <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker/bin/runbroker.sh:/home/rocketmq/rocketmq-5.1.1/bin/runbroker.sh <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;MAX_HEAP_SIZE=512M&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;HEAP_NEWSIZE=256M&quot;</span> <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /home/rocketmq/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>参数说明</strong>：</p><table><thead><tr><th>参数</th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>-v /tmp/rocketmq/broker/bin/runbroker.sh:/home/rocketmq/rocketmq-5.1.1/bin/runbroker.sh \</td><td>挂载broker启动脚本（需要自己定义堆内存时使用）</td></tr><tr><td>sh mqbroker -c /home/rocketmq/broker.conf</td><td>启动broker服务，使用自定义配置文件</td></tr></tbody></table><h3 id="_1-4部署proxy" tabindex="-1"><a class="header-anchor" href="#_1-4部署proxy" aria-hidden="true">#</a> 1.4部署Proxy</h3><ul><li><p>在 Local 模式下，Broker 和 Proxy 是同进程部署，只是在原有 Broker 的配置基础上新增 Proxy 的简易配置就可以运行，使用 <code>--enable-proxy</code>。目前，加上 <code>--enable-proxy</code>，容器无法启动，原因暂不知道。</p></li><li><p>在 Cluster 模式下，Broker 和 Proxy 分别部署，即在原有的集群基础上，额外再部署 Proxy 即可，使用 <code>sh mqproxy</code>。</p></li></ul><h3 id="_1-5部署rocketmq控制台" tabindex="-1"><a class="header-anchor" href="#_1-5部署rocketmq控制台" aria-hidden="true">#</a> 1.5部署RocketMQ控制台</h3><h4 id="拉取镜像" tabindex="-1"><a class="header-anchor" href="#拉取镜像" aria-hidden="true">#</a> 拉取镜像</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> pull apacherocketmq/rocketmq-dashboard:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="启动rocketmq控制台" tabindex="-1"><a class="header-anchor" href="#启动rocketmq控制台" aria-hidden="true">#</a> 启动RocketMQ控制台</h4><p>控制台访问-地址ip:端口：<a href="http://192.168.100.100:8080" target="_blank" rel="noopener noreferrer">http://192.168.100.100:8080<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqdashboard <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPTS=-Xmx256M -Xms256M -Xmn128M -Drocketmq.namesrv.addr=192.168.100.100:9876&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
apacherocketmq/rocketmq-dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6broker配置详解" tabindex="-1"><a class="header-anchor" href="#_1-6broker配置详解" aria-hidden="true">#</a> 1.6Broker配置详解</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameServer 地址多个用;隔开 默认值null</span>
<span class="token comment"># 例：127.0.0.1:6666;127.0.0.1:8888 </span>
namesrvAddr <span class="token operator">=</span> <span class="token number">127.0</span>.0.1:6666
<span class="token comment"># 集群名称 单机配置可以随意填写，如果是集群部署在同一个集群中集群名称必须一致类似Nacos的命名空间</span>
brokerClusterName <span class="token operator">=</span> DefaultCluster
<span class="token comment"># broker节点名称 单机配置可以随意填写，如果是集群部署在同一个集群中节点名称不要重复</span>
brokerName <span class="token operator">=</span> broker-a
<span class="token comment"># broker id节点ID， 0 表示 master, 其他的正整数表示 slave，不能小于0 </span>
brokerId <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># Broker 对外服务的监听端口 默认值10911</span>
<span class="token comment"># 端口（注意：broker启动后，会占用3个端口，分别在listenPort基础上-2，+1，供内部程序使用，所以集群一定要规划好端口，避免冲突）</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment"># Broker服务地址	String	内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP1 <span class="token operator">=</span> <span class="token number">127.0</span>.0.1
<span class="token comment"># BrokerHAIP地址，供slave同步消息的地址 内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP2 <span class="token operator">=</span> <span class="token number">127.0</span>.0.1

<span class="token comment"># Broker角色 默认值ASYNC_MASTER</span>
<span class="token comment"># ASYNC_MASTER 异步复制Master，只要主写成功就会响应客户端成功，如果主宕机可能会出现小部分数据丢失</span>
<span class="token comment"># SYNC_MASTER 同步双写Master，主和从节点都要写成功才会响应客户端成功，主宕机也不会出现数据丢失</span>
<span class="token comment"># SLAVE</span>
brokerRole <span class="token operator">=</span> ASYNC_MASTER
<span class="token comment"># 刷盘方式</span>
<span class="token comment"># SYNC_FLUSH（同步刷新）相比于ASYNC_FLUSH（异步处理）会损失很多性能，但是也更可靠，所以需要根据实际的业务场景做好权衡，默认值ASYNC_FLUSH</span>
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token comment"># 在每天的什么时间删除已经超过文件保留时间的 commit log，默认值04</span>
deleteWhen <span class="token operator">=</span> 04
<span class="token comment"># 以小时计算的文件保留时间 默认值72小时</span>
fileReservedTime <span class="token operator">=</span> <span class="token number">72</span>

<span class="token comment"># 消息大小 单位字节 默认1024 * 1024 * 4</span>
<span class="token assign-left variable">maxMessageSize</span><span class="token operator">=</span><span class="token number">4194304</span>

<span class="token comment"># 在发送消息时，自动创建服务器不存在的Topic，默认创建的队列数，默认值4</span>
<span class="token assign-left variable">defaultTopicQueueNums</span><span class="token operator">=</span><span class="token number">4</span>
<span class="token comment"># 是否允许Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment"># 是否允许Broker自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true

<span class="token comment"># 失败重试时间，默认重试16次进入死信队列，第一次1s第二次5s以此类推。</span>
<span class="token comment"># 延时队列时间等级默认18个，可以设置多个比如在后面添加一个1d(一天)，使用的时候直接用对应时间等级即可,从1开始到18，如果添加了第19个直接使用等级19即可</span>
<span class="token assign-left variable">messageDelayLevel</span><span class="token operator">=</span>1s 5s 10s 30s 1m 2m 3m 4m 5m 6m 7m 8m 9m 10m 20m 30m 1h 2h

<span class="token comment"># 指定TM在20秒内应将最终确认状态发送给TC，否则引发消息回查。默认为60秒</span>
<span class="token assign-left variable">transactionTimeout</span><span class="token operator">=</span><span class="token number">20</span>
<span class="token comment"># 指定最多回查5次，超过后将丢弃消息并记录错误日志。默认15次。</span>
<span class="token assign-left variable">transactionCheckMax</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># 指定设置的多次消息回查的时间间隔为10秒。默认为60秒。</span>
<span class="token assign-left variable">transactionCheckInterval</span><span class="token operator">=</span><span class="token number">10</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-docker多节点单副本部署" tabindex="-1"><a class="header-anchor" href="#_2-docker多节点单副本部署" aria-hidden="true">#</a> 2.Docker多节点单副本部署</h2><h3 id="_2-1启动nameserver" tabindex="-1"><a class="header-anchor" href="#_2-1启动nameserver" aria-hidden="true">#</a> 2.1启动NameServer</h3><p>创建挂载文件夹 与 设置权限 同Docker单机部署。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqnamesrv <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">9876</span>:9876  <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/nameserver/logs:/home/rocketmq/logs <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token function">sh</span> mqnamesrv
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2启动broker-proxy" tabindex="-1"><a class="header-anchor" href="#_2-2启动broker-proxy" aria-hidden="true">#</a> 2.2启动Broker+Proxy</h3><h4 id="挂载目录" tabindex="-1"><a class="header-anchor" href="#挂载目录" aria-hidden="true">#</a> 挂载目录</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建需要的挂载目录1</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1/logs <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1/data <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1/conf <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1/bin

<span class="token comment"># 创建需要的挂载目录2</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker2/logs <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker2/data <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker2/conf <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker2/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="设置权限-2" tabindex="-1"><a class="header-anchor" href="#设置权限-2" aria-hidden="true">#</a> 设置权限</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 777 文件所属者、文件所属组和其他人有 [读取 &amp; 写入 &amp; 执行]全部权限。rwxrwxrwx</span>
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /tmp/rocketmq/broker1/*
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /tmp/rocketmq/broker2/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建broker-conf文件-1" tabindex="-1"><a class="header-anchor" href="#创建broker-conf文件-1" aria-hidden="true">#</a> 创建broker.conf文件</h4><p>broker1：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vi</span> /tmp/rocketmq/broker1/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameServer 地址多个用;隔开 默认值null</span>
<span class="token comment"># 例：127.0.0.1:6666;127.0.0.1:8888 </span>
namesrvAddr <span class="token operator">=</span> <span class="token number">192.168</span>.100.100:9876
<span class="token comment"># 集群名称</span>
brokerClusterName <span class="token operator">=</span> DefaultCluster
<span class="token comment"># 节点名称</span>
brokerName <span class="token operator">=</span> broker-a
<span class="token comment"># broker id节点ID， 0 表示 master, 其他的正整数表示 slave，不能小于0 </span>
brokerId <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># Broker服务地址 String	内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP1 <span class="token operator">=</span> <span class="token number">192.168</span>.100.100
<span class="token comment">#broker的服务端口，默认10911</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">10911</span>
<span class="token comment"># Broker角色</span>
brokerRole <span class="token operator">=</span> ASYNC_MASTER
<span class="token comment"># 刷盘方式</span>
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token comment"># 在每天的什么时间删除已经超过文件保留时间的 commit log，默认值04</span>
deleteWhen <span class="token operator">=</span> 04
<span class="token comment"># 以小时计算的文件保留时间 默认值72小时</span>
fileReservedTime <span class="token operator">=</span> <span class="token number">72</span>
<span class="token comment"># 是否允许Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment"># 是否允许Broker自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>broker2：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>vi /tmp/rocketmq/broker2/conf/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameServer 地址多个用;隔开 默认值null</span>
<span class="token comment"># 例：127.0.0.1:6666;127.0.0.1:8888 </span>
namesrvAddr <span class="token operator">=</span> <span class="token number">192.168</span>.100.100:9876
<span class="token comment"># 集群名称</span>
brokerClusterName <span class="token operator">=</span> DefaultCluster
<span class="token comment"># 节点名称</span>
brokerName <span class="token operator">=</span> broker-b
<span class="token comment"># broker id节点ID， 0 表示 master, 其他的正整数表示 slave，不能小于0 </span>
brokerId <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># Broker服务地址 String	内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP1 <span class="token operator">=</span> <span class="token number">192.168</span>.100.100
<span class="token comment">#broker的服务端口，和节点a区分开</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">11911</span>
<span class="token comment"># Broker角色</span>
brokerRole <span class="token operator">=</span> ASYNC_MASTER
<span class="token comment"># 刷盘方式</span>
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token comment"># 在每天的什么时间删除已经超过文件保留时间的 commit log，默认值04</span>
deleteWhen <span class="token operator">=</span> 04
<span class="token comment"># 以小时计算的文件保留时间 默认值72小时</span>
fileReservedTime <span class="token operator">=</span> <span class="token number">72</span>
<span class="token comment"># 是否允许Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment"># 是否允许Broker自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="brocker监听端口" tabindex="-1"><a class="header-anchor" href="#brocker监听端口" aria-hidden="true">#</a> Brocker监听端口</h4><ul><li>listenPort：默认10911，接受客户端连接的监听端口，作为对producer和consumer使用服务的端口号，可以通过配置文件改</li><li>haListenPort：默认为listenPort + 1，高可用服务监听端口，主要用于slave同master同步</li><li>fastListenPort：默认为listenPort -2， 主要是fastRemotingServer服务使用，用于VIP通道</li></ul><h4 id="启动brocker1-proxy" tabindex="-1"><a class="header-anchor" href="#启动brocker1-proxy" aria-hidden="true">#</a> 启动brocker1 + Proxy：</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker1 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">10911</span>:10911 <span class="token parameter variable">-p</span> <span class="token number">10909</span>:10909 <span class="token parameter variable">-p</span> <span class="token number">10912</span>:10912 <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1/conf/broker.conf:/home/rocketmq/broker.conf <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /home/rocketmq/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动brocker2-proxy" tabindex="-1"><a class="header-anchor" href="#启动brocker2-proxy" aria-hidden="true">#</a> 启动brocker2 + Proxy：</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker2 <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">11911</span>:11911 <span class="token parameter variable">-p</span> <span class="token number">11909</span>:11909 <span class="token parameter variable">-p</span> <span class="token number">11912</span>:11912 <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker2/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker2/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker2/conf/broker.conf:/home/rocketmq/broker.conf <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /home/rocketmq/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="rocketmq控制台" tabindex="-1"><a class="header-anchor" href="#rocketmq控制台" aria-hidden="true">#</a> RocketMQ控制台</h4><p>控制台访问-地址ip:端口：<a href="http://192.168.100.100:8080" target="_blank" rel="noopener noreferrer">http://192.168.100.100:8080<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqdashboard <span class="token punctuation">\</span>
<span class="token parameter variable">-e</span> <span class="token string">&quot;JAVA_OPTS=-Xmx256M -Xms256M -Xmn128M -Drocketmq.namesrv.addr=192.168.100.100:9876&quot;</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">8080</span>:8080 <span class="token punctuation">\</span>
apacherocketmq/rocketmq-dashboard
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-docker单主单从" tabindex="-1"><a class="header-anchor" href="#_3-docker单主单从" aria-hidden="true">#</a> 3.Docker单主单从</h2><p>在 2.Docker多节点单副本的基础上，添加 broker1-s ，关闭broker2。</p><h3 id="挂载目录-1" tabindex="-1"><a class="header-anchor" href="#挂载目录-1" aria-hidden="true">#</a> 挂载目录</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 创建需要的挂载目录1</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1-s/logs <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1-s/data <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1-s/conf <span class="token punctuation">\</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/rocketmq/broker1-s/bin
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建broker-conf文件-2" tabindex="-1"><a class="header-anchor" href="#创建broker-conf文件-2" aria-hidden="true">#</a> 创建broker.conf文件</h3><p>brocker1的副本：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>vi /tmp/rocketmq/broker1-s/conf/broker-s.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># nameServer 地址多个用;隔开 默认值null</span>
<span class="token comment"># 例：127.0.0.1:6666;127.0.0.1:8888 </span>
namesrvAddr <span class="token operator">=</span> <span class="token number">192.168</span>.100.100:9876
<span class="token comment"># 集群名称</span>
brokerClusterName <span class="token operator">=</span> DefaultCluster
<span class="token comment"># 节点名称</span>
brokerName <span class="token operator">=</span> broker-a
<span class="token comment"># broker id节点ID， 0 表示 master, 其他的正整数表示 slave，不能小于0 </span>
brokerId <span class="token operator">=</span> <span class="token number">1</span>
<span class="token comment"># Broker服务地址 String	内部使用填内网ip，如果是需要给外部使用填公网ip</span>
brokerIP1 <span class="token operator">=</span> <span class="token number">192.168</span>.100.100
<span class="token comment">#broker的服务端口，默认10911</span>
<span class="token assign-left variable">listenPort</span><span class="token operator">=</span><span class="token number">12911</span>
<span class="token comment"># Broker角色</span>
brokerRole <span class="token operator">=</span> SLAVE
<span class="token comment"># 刷盘方式</span>
flushDiskType <span class="token operator">=</span> ASYNC_FLUSH
<span class="token comment"># 在每天的什么时间删除已经超过文件保留时间的 commit log，默认值04</span>
deleteWhen <span class="token operator">=</span> 04
<span class="token comment"># 以小时计算的文件保留时间 默认值72小时</span>
fileReservedTime <span class="token operator">=</span> <span class="token number">72</span>
<span class="token comment"># 是否允许Broker 自动创建Topic，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateTopicEnable</span><span class="token operator">=</span>true
<span class="token comment"># 是否允许Broker自动创建订阅组，建议线下开启，线上关闭</span>
<span class="token assign-left variable">autoCreateSubscriptionGroup</span><span class="token operator">=</span>true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置权限-3" tabindex="-1"><a class="header-anchor" href="#设置权限-3" aria-hidden="true">#</a> 设置权限</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 777 文件所属者、文件所属组和其他人有 [读取 &amp; 写入 &amp; 执行]全部权限。rwxrwxrwx</span>
<span class="token function">chmod</span> <span class="token number">777</span> <span class="token parameter variable">-R</span> /tmp/rocketmq/broker1-s/*
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动brocker1-s-proxy" tabindex="-1"><a class="header-anchor" href="#启动brocker1-s-proxy" aria-hidden="true">#</a> 启动brocker1-s + Proxy：</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--name</span> rmqbroker1-s <span class="token punctuation">\</span>
<span class="token parameter variable">-p</span> <span class="token number">12911</span>:12911 <span class="token parameter variable">-p</span> <span class="token number">12909</span>:12909 <span class="token parameter variable">-p</span> <span class="token number">12912</span>:12912 <span class="token punctuation">\</span>
<span class="token parameter variable">--privileged</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1-s/logs:/root/logs <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1-s/store:/root/store <span class="token punctuation">\</span>
<span class="token parameter variable">-v</span> /tmp/rocketmq/broker1-s/conf/broker-s.conf:/home/rocketmq/broker.conf <span class="token punctuation">\</span>
apache/rocketmq:5.1.1 <span class="token punctuation">\</span>
<span class="token function">sh</span> mqbroker <span class="token parameter variable">-c</span> /home/rocketmq/broker.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/blog/assets/app-66d6b4fd.js" defer></script>
  </body>
</html>
